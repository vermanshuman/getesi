<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ff="http://readytech.com/functions" xmlns:H="http://java.sun.com/jsf/html"
                template="/resources/tpl/Admin/EditBase.xhtml">
    <ui:param name="bean" value="#{estateSituationEditBean}"/>
    <ui:define name="edit_body">
        <div align="center">
            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                         style="text-align: left;width: 75%;">
                <p:column rendered="#{bean.requestEntity.subject ne null}"><span style="font-size:20px;">
                    #{ff:upper(msg.estateSituationEditSubjectName)}
                    <b>#{ff:upper(bean.requestEntity.subject.fullName)}</b>
                </span></p:column>
                <p:column rendered="#{bean.requestEntity.subject eq null and bean.requestHasDistraintFormality}"><span style="font-size:20px;">
                    #{ff:upper(msg.estateSituationEditSubjectName)}
                    <b>#{ff:upper(bean.requestEntity.nameStr)}</b>
					</span></p:column>
                <p:column><span style="font-size:20px;">
                    #{ff:upper(msg.estateSituationEditConservatory)}
                    <b>#{ff:upper(bean.requestEntity.aggregationLandChargesRegistryName)}</b>
                </span></p:column>
                <p:column><span style="font-size:20px;">
                    #{ff:upper(msg.estateSituationEditRequestType)} #{ff:upper(bean.requestEntity.service.name)}
                </span></p:column>
                <p:column><span style="font-size:20px;">
                    #{ff:upper(msg.estateSituationEditClientName)} #{ff:upper(bean.requestEntity.clientName)}
                </span></p:column>
            </p:panelGrid>
        </div>
        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid">
            <p:column>
                <h:panelGroup style="font-size: 16px;"  rendered="#{!bean.salesDevelopment}">#{msg.formality}</h:panelGroup>
                <p:dataTable value="#{bean.formalityList}" selection="#{bean.selectedFormality}"
                             rendered="#{!bean.salesDevelopment}"
                             styleClass="simple-table estate-situation-edit-select"
                             var="item" id="formalityTab" rowSelectMode="checkbox"
                             rowKey="#{item.id}"
                             rowStyleClass="#{item.used?'user-row':''}"
                             paginator="true" paginatorAlwaysVisible="false" rows="20"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="20,50,100">
                    <p:column styleClass="action_column" selectionMode="multiple"/>
                    <p:column headerText="#{msg.estateFormalityDate}" width="12%">
                        <h:outputText value="#{item.date}" converter="dateTimeConverter"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityNumRG}" width="10%">
                        <h:outputText value="#{item.numRG}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityNumRP}" width="10%">
                        <h:outputText value="#{item.numRP}"/>
                    </p:column>
                    <p:column style="width: 7%" headerText="#{msg.estateFormalityTypeShort}">
                        <h:outputText value="#{item.estateFormalityType.toString()}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityTypeAct}">
                        <h:outputText id="estate" value="#{item.typeAct.description}"/>
                        <p:tooltip for="estate" position="left" value="#{item.typeAct.description}"/>
                    </p:column>
                </p:dataTable>
            </p:column>
            <p:column>
                <h:panelGroup style="font-size: 16px;"  rendered="#{!bean.salesDevelopment}">#{msg.estateLocation}</h:panelGroup>
                <p:dataTable value="#{bean.propertyList}" selection="#{bean.selectedProperty}"
                             styleClass="simple-table estate-situation-edit-select"
                             var="item" id="estateTab"  rowSelectMode="checkbox"
                             rowKey="#{item.id}"  rendered="#{!bean.salesDevelopment}"
                             rowStyleClass="#{item.used?'user-row':''}"
                             paginator="true" paginatorAlwaysVisible="false" rows="20"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="20,50,100">

                    <p:column styleClass="action_column" selectionMode="multiple" rendered="#{!item.used or bean.isExistsInEstateSituation(item)}">
                        <p:rowToggler expandLabel="#{msg.estateFormalityChange}" rendered="#{not empty item.datafromPropertiesUpdated}"
                                      collapseLabel="#{msg.estateFormalityChange}"/>
                    </p:column>
                    <p:column styleClass="action_column" rendered="#{item.used and !bean.isExistsInEstateSituation(item)}">
                        <p:rowToggler expandLabel="#{msg.estateFormalityChange}" rendered="#{not empty item.datafromPropertiesUpdated}"
                                      collapseLabel="#{msg.estateFormalityChange}"/>
                    </p:column>

                    <p:column headerText="#{msg.estateTypeShort}" width="10%">
                        <h:outputText value="#{item.category.codeInVisura}" id="category"/>
                        <p:tooltip for="category" value="#{item.category.description}"/>
                    </p:column>
                    <p:column headerText="#{msg.databaseListRealEstateCity}">
                        <h:outputText value="#{item.cityDescription}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateCadastralData}">
                        <p:dataTable value="#{item.cadastralData}" var="exam"
                                     rendered="#{not empty item.cadastralData}"
                                     styleClass="without-header cadastral_table">
                            <p:column>
                                <h:outputText value="#{exam.section}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                              style="font-size: 1.1em; font-weight:bold;"/>
                                <h:outputText value="#{exam.scheda}/#{exam.dataScheda}"
                                              rendered="#{not empty exam.scheda and not empty exam.dataScheda}"
                                              style="font-size: 1.1em; font-weight:bold;"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{exam.sheet}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                              style="font-size: 1.1em; font-weight:bold;"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{exam.particle}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                              style="font-size: 1.1em; font-weight:bold;"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{exam.sub}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                              style="font-size: 1.1em; font-weight:bold;"/>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                    <p:rowExpansion>
                        <p:dataTable value="#{item.datafromPropertiesUpdated}" var="datafromP"
                                     styleClass="without-header cadastral_table">
                            <p:column styleClass="action_column">
                                <p:selectBooleanCheckbox value="#{datafromP.associated}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{datafromP.text}"/>
                            </p:column>
                        </p:dataTable>
                    </p:rowExpansion>
                </p:dataTable>
            </p:column>
        </p:panelGrid>
        <p:panelGrid columns="1" styleClass="ui-panelgrid-blank form-group" layout="grid">
        <script type="text/javascript">
        
    		// <![CDATA[
    			 jQuery(document).ready(function() {
    				 jQuery('.select_checkbox_exam').click(function() {
    					 var checkboxcls = $(this).attr('class').replace("ui-chkbox ui-widget select_checkbox_exam", "").trim();
    					 var cls = $(this).find(".ui-chkbox-icon").attr('class')
    					 if(cls === 'ui-chkbox-icon ui-icon ui-c ui-icon-check'){
    						 jQuery('#checkboxvalue').val(checkboxcls + "_true");	 
    					 }else {
    						 jQuery('#checkboxvalue').val(checkboxcls + "_false");
    					 }
    					 jQuery('.hdnBtn').click();
	     	  		});
    				 
    			 });
    				// ]]>
    	</script>
    	 	<p:commandButton class="hdnBtn" id="hdnBtn" ajax="true" actionListener="#{bean.updateSaveMap()}" style="display: none;" process="@(.myClass :input)" update="@([id$=cadastral_table])"/>
        	<input type="hidden" id="checkboxvalue" name="checkboxvalue" value="" />
            <p:column>
                <p:outputPanel style="margin-bottom: 5px;">
                    <h:outputText value="#{msg.pdfFormality}" style="font-size: 16px;"/>
                    <p:outputPanel style="margin-top: 3px;" rendered="#{bean.requestHasDistraintFormality}">
                        <h:outputText value="#{msg.estateSituationEditOtherType} "/>
                        <p:selectBooleanCheckbox value="#{bean.otherTypeFormalities}" style="margin-left: 10px;"/>
                        <h:outputText value="#{msg.estateFormalityReportRelationShip} "  style="margin-left: 40px;margin-right: 10px;"/>
                        <p:selectBooleanCheckbox value="#{bean.reportRelationship}"/>
                    </p:outputPanel>
                </p:outputPanel>
                <p:dataTable value="#{bean.formalityPDFList}" styleClass="simple-table" var="item" id="formalityPDFTab">
                    <p:column styleClass="action_column special-toggler"
                              exportable="false" width="5%">
                         <p:selectBooleanCheckbox value="#{item.visible}" id="visibleCB"  styleClass="select_checkbox_exam #{item.id}"/>
                        <p:rowToggler rendered="#{bean.requestHasDistraintFormality and item.propertiesAreExist}"
                                      expandLabel="#{msg.estateFormalityProperty}"
                                      collapseLabel="#{msg.estateFormalityProperty}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityConservatory}" width="15%">
                        <h:outputText value="#{item.conservatoryName}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityTypeNote}" width="6%">
                        <h:outputText value="#{item.typeEnum}" converter="enumConverter"/>
                    </p:column>
                    <p:column headerText="#{msg.formalityPresentationDate}" width="6%">
                        <h:outputText value="#{item.presentationDate}" converter="dateTimeConverter"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityNumRG}" width="6%">
                        <h:outputText value="#{item.generalRegister}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityNumRP}" width="6%">
                        <h:outputText value="#{item.particularRegister}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityTypeShort}" width="3%">
                        <h:outputText value="#{item.currentSubjectType}"/>
                    </p:column>
                    <p:column headerText="#{msg.estateFormalityTypeAct}">
                        <h:outputText value="#{item.actType}"/>
                    </p:column>
                    <p:column headerText="#{msg.status}" width="6%">
                        <h:outputText value="#{item.statusStr}"/>
                    </p:column>
                    <p:rowExpansion>
                        <p:dataTable value="#{item.propertiesLoad}" var="property"
                                     styleClass="without-header cadastral_table" id="cadastral_table">
                            <p:column styleClass="action_column">
                                <p:selectBooleanCheckbox value="#{property.selected}">
                                    <p:ajax event="change" listener="#{bean.changeSaveMap(item,property.id)}" update=":form:formalityPDFTab:visibleCB"/>
                                </p:selectBooleanCheckbox>
                            </p:column>
                            <p:column style="width: 8%">
                                <h:outputText value="#{property.category.codeInVisura}" id="propertyCategory"/>
                                <p:tooltip for="propertyCategory" value="#{property.category.description}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{property.address}"/>
                            </p:column>
                            <p:column>
                                <p:dataTable value="#{property.cadastralData}" var="cad"
                                             rendered="#{not empty property.cadastralData}"
                                             styleClass="without-header cadastral_table">
                                    <p:column>
                                        <h:outputText value="#{cad.section}"
                                                      rendered="#{empty cad.scheda and empty cad.dataScheda}"
                                                      styleClass="cadastral_text"/>
                                        <h:outputText value="#{cad.scheda}/#{cad.dataScheda}"
                                                      rendered="#{not empty cad.scheda and not empty cad.dataScheda}"
                                                      styleClass="cadastral_text"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{cad.sheet}"
                                                      rendered="#{empty cad.scheda and empty cad.dataScheda}"
                                                      styleClass="cadastral_text"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{cad.particle}"
                                                      rendered="#{empty cad.scheda and empty cad.dataScheda}"
                                                      styleClass="cadastral_text"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{cad.sub}"
                                                      rendered="#{empty cad.scheda and empty cad.dataScheda}"
                                                      styleClass="cadastral_text"/>
                                    </p:column>
                                </p:dataTable>
                            </p:column>
                        </p:dataTable>
                    </p:rowExpansion>
                </p:dataTable>
            </p:column>
        </p:panelGrid>
    </ui:define>
    <ui:define name="additional_buttons">
        <p:commandButton id="backBtn" action="#{bean.goCancel}"
                         value="#{msg.goBack}"
                         icon="fa fa-chevron-circle-left"/>
    </ui:define>
    <ui:define name="dialog_body">
        <p:dialog widgetVar="cadastralInvalidDlg" modal="true" resizable="false" effect="SLIDE">
            <h:outputText value="#{msg.estateSituationFormalityValidation}"/><br/>
            <br/>
            <div>
                <p:commandButton value="#{msg.yes}" action="#{bean.pageSave}" process="@this">
                    <f:setPropertyActionListener value="false" target="#{bean.needValidation}"/>
                </p:commandButton>
                <p:commandButton value="#{msg.no}" onclick="PF('cadastralInvalidDlg').hide()" process="@this"/>
            </div>
        </p:dialog>
        <p:dialog widgetVar="propertyCityDlg" modal="true" resizable="false" effect="SLIDE">
            <h:outputText value="#{msg.estateSituationPropertyCity}" escape="false"/><br/>
            <br/>
            <div>
                <p:commandButton value="#{msg.yes}" action="#{bean.pageSave}" process="@this">
                    <f:setPropertyActionListener value="true" target="#{bean.propertyConfirmed}"/>
                </p:commandButton>
                <p:commandButton value="#{msg.no}" onclick="PF('propertyCityDlg').hide()" process="@this"/>
            </div>
        </p:dialog>
    </ui:define>
</ui:composition>