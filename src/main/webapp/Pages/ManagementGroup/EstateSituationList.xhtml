<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/resources/tpl/Admin/ListBase.xhtml">ss
    <ui:param name="bean" value="#{estateSituationListBean}"/>
    <ui:param name="renderTitle" value="false"/>
    <ui:param name="renderMenu" value="false"/>
    <ui:param name="centerPartStyleClass" value="false"/>
    <ui:param name="disableSelection" value="true"/>
    <ui:define name="back_buttons_panel">
        <p:commandButton id="add_btn" action="#{bean.addEstate}" value="#{msg.estateAddButton}"/>
        <p:commandButton id="cancel_btn" action="#{bean.goBack}" value="#{msg.requestListOpenEdit}"
                         icon="ui-icon-circle-close"/>
        <p:commandButton id="print_btn" action="#{bean.goTextEdit}" value="#{msg.requestManagePrint}"
                         style="float: right"/>
    </ui:define>
    <ui:define name="columns">
        <p:column headerText="#{msg.formality}">
            <p:dataTable rendered="#{not empty item.estateFormalityList}" value="#{item.estateFormalityList}"
                         var="weakForm" styleClass="without-header cadastral_table">
                <p:column>
                    <span>#{weakForm.numRP}/#{weakForm.numRG} #{msg.estateFormalityDatePrefix}</span><h:outputText
                        value="#{weakForm.date}" converter="dateTimeConverter"/>
                </p:column>
                <p:column style="width: 8%">
                    <h:outputText value="#{weakForm.estateFormalityType.toString()}"/>
                </p:column>
                <p:column style="padding: 2px">
                    <h:outputText id="estate" value="#{weakForm.description}"/>
                    <p:tooltip for="estate" position="left" value="#{weakForm.description}"/>
                </p:column>
            </p:dataTable>
        </p:column>
        <p:column headerText="#{msg.estateLocation}">
            <p:dataTable rendered="#{not empty item.propertyList}" value="#{item.propertyList}" var="estate"
                         styleClass="without-header cadastral_table">
                <p:column style="width: 8%">
                    <h:outputText value="#{estate.category.codeInVisura}" id="category"/>
                    <p:tooltip for="category" value="#{estate.category.description}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{estate.address}"/>
                </p:column>
                <p:column>
                    <p:dataTable value="#{estate.cadastralData}" var="exam"
                                 rendered="#{not empty estate.cadastralData}"
                                 styleClass="without-header cadastral_table">
                        <p:column>
                            <h:outputText value="#{exam.section}"
                                          rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                          style="font-size: 1.1em; font-weight:bold;"/>
                            <h:outputText value="#{exam.scheda}/#{exam.dataScheda}"
                                          rendered="#{not empty exam.scheda and not empty exam.dataScheda}"
                                          style="font-size: 1.1em; font-weight:bold;"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{exam.sheet}"
                                          rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                          style="font-size: 1.1em; font-weight:bold;"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{exam.particle}"
                                          rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                          style="font-size: 1.1em; font-weight:bold;"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{exam.sub}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                          style="font-size: 1.1em; font-weight:bold;"/>
                        </p:column>
                    </p:dataTable>
                </p:column>
            </p:dataTable>
        </p:column>
        <p:column headerText="#{msg.pdfFormality}">
            <p:dataTable rendered="#{not empty item.formalityList}" value="#{item.formalityList}"
                         styleClass="without-header cadastral_table" var="item">
                <p:column>
                    <h:outputText value="#{item.formalityStr}"/>
                </p:column>
                <p:column>
                    <h:outputText value="#{item.type}"/><br/>
                    <h:outputText value="#{item.sectionA.titleDescription}"/>
                </p:column>
            </p:dataTable>
        </p:column>
    </ui:define>
    <ui:define name="dialogs_body">
        <br/>
        <p:fieldset legend="#{msg.estateSituationListDocuments}">
            <p:fileUpload label="#{msg.upload}" fileUploadListener="#{bean.saveDocumentXML}"
                          multiple="false" mode="advanced" styleClass="special-upload" auto="true"
                          update=":form:documentTable"/>
            <p:dataTable var="item" id="documentTable" value="#{bean.documentList}" lazy="true"
                         emptyMessage="#{msg.noRecordsFound}">
                <p:column headerText="#{msg.databaseListDocumentTitle}">
                    <h:outputText value="#{item.title}"/>
                </p:column>
                <ui:remove>
                    <p:column headerText="#{msg.databaseListDocumentTypes}">
                        <h:outputText value="#{item.typeDescription}"/>
                    </p:column>
                </ui:remove>
                <p:column styleClass="action_column">
                    <p:commandButton icon="fa fa-download" action="#{item.downloadFile}" ajax="false"/>
                </p:column>
                <p:column styleClass="action_column">
                    <p:commandButton icon="ui-icon ui-icon-close" update=":form"
                                     action="#{bean.deleteEntityDocument}">
                        <f:setPropertyActionListener value="#{item.id}" target="#{bean.entityDeleteId}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </p:fieldset>
        <ui:fragment><br /></ui:fragment>
        <p:fieldset legend="#{msg.estateSituationSalesDevelopmentHeader}" rendered="#{bean.salesDevelopmentShowing}">
            <p:commandButton disabled="#{!bean.canCreate}" id="buttonCreateSalesDevelopment"
                             icon="ui-icon-circle-plus"
                             value="#{not empty addButtonTitle ? addButtonTitle : msg.newItem}"
                             update="sales_dev"
                             action="#{bean.addSalesEntity()}"/>
            <p:commandButton disabled="#{!bean.canCreate}" id="autoCreateSalesDevelopment"
                             icon="ui-icon-circle-plus" value="#{msg.estateSituationSalesDevelopmentAutoCreate}"
                             update="sales_dev" onclick="PF('autoCreateSalesDevelopment').disable()"
                             oncomplete="PF('autoCreateSalesDevelopment').enable()"
                             action="#{bean.autoAddEntity()}" widgetVar="autoCreateSalesDevelopment"/>
            <ui:fragment><br /></ui:fragment>
            <ui:fragment><br /></ui:fragment>
            <p:dataTable var="item" id="sales_dev" value="#{bean.salesEstateSituationList}"
                         disabledSelection="true" lazy="#{lazyMode}"
                         paginator="true" rowKey="#{item.id}" rows="10"
                         selectionMode="single" selection="#{bean.selectedItem}" reflow="true"
                         paginatorAlwaysVisible="true" emptyMessage="#{msg.noRecordsFound}"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="10,20,50" widgetVar="salesTableWV">
                <p:column styleClass="action_column" exportable="false">
                    <p:commandButton icon="ui-icon ui-icon-pencil"
                                     disabled="#{!bean.canEdit}" update=":form"
                                     action="#{bean.editEntity}">
                        <f:setPropertyActionListener value="#{item.id}"
                                                     target="#{bean.entityEditId}"/>
                    </p:commandButton>
                </p:column>
                <p:column styleClass="action_column" exportable="false">
                    <p:commandButton icon="ui-icon ui-icon-close"
                                     oncomplete="PF('salesdlg').show()"
                                     disabled="#{!bean.canDelete || (item.id==sessionBean.currentUser.id and bean.userEntityPage)}">
                        <f:setPropertyActionListener value="#{item.id}"
                                                     target="#{bean.deletedSalesId}"/>
                    </p:commandButton>
                </p:column>
                <p:column headerText="#{msg.formality}">
                    <p:dataTable rendered="#{not empty item.estateFormalityList}" value="#{item.estateFormalityList}"
                                 var="weakForm" styleClass="without-header cadastral_table">

                        <p:column>
                            <span>#{weakForm.numRP}/#{weakForm.numRG} #{msg.estateFormalityDatePrefix}</span><h:outputText
                                value="#{weakForm.date}" converter="dateTimeConverter"/>
                        </p:column>
                        <p:column style="width: 8%">
                            <h:outputText value="#{weakForm.estateFormalityType.toString()}"/>
                        </p:column>
                        <p:column style="padding: 2px">
                            <h:outputText id="sales_estate" value="#{weakForm.description}"/>
                            <p:tooltip for="sales_estate" position="left" value="#{weakForm.description}"/>
                        </p:column>
                    </p:dataTable>
                </p:column>
                <p:column headerText="#{msg.estateLocation}">
                    <p:dataTable rendered="#{not empty item.propertyList}" value="#{item.propertyList}" var="estate"
                                 styleClass="without-header cadastral_table">
                        <p:column style="width: 8%">
                            <h:outputText value="#{estate.category.codeInVisura}" id="sales_category"/>
                            <p:tooltip for="sales_category" value="#{estate.category.description}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{estate.address}"/>
                        </p:column>
                        <p:column>
                            <p:dataTable value="#{estate.cadastralData}" var="exam"
                                         rendered="#{not empty estate.cadastralData}"
                                         styleClass="without-header cadastral_table">
                                <p:column>
                                    <h:outputText value="#{exam.section}"
                                                  rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                                  style="font-size: 1.1em; font-weight:bold;"/>
                                    <h:outputText value="#{exam.scheda}/#{exam.dataScheda}"
                                                  rendered="#{not empty exam.scheda and not empty exam.dataScheda}"
                                                  style="font-size: 1.1em; font-weight:bold;"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{exam.sheet}"
                                                  rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                                  style="font-size: 1.1em; font-weight:bold;"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{exam.particle}"
                                                  rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                                  style="font-size: 1.1em; font-weight:bold;"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{exam.sub}" rendered="#{empty exam.scheda and empty exam.dataScheda}"
                                                  style="font-size: 1.1em; font-weight:bold;"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:dataTable>
                </p:column>
                <p:column headerText="#{msg.pdfFormality}">
                    <p:dataTable rendered="#{not empty item.formalityList}" value="#{item.formalityList}"
                                 styleClass="without-header cadastral_table" var="item">
                        <p:column>
                            <h:outputText value="#{item.formalityStr}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{item.type}"/><br/>
                            <h:outputText value="#{item.sectionA.titleDescription}"/>
                        </p:column>
                    </p:dataTable>
                </p:column>
            </p:dataTable>
        </p:fieldset>
        <div align="center">
        <h:outputText value="#{bean.externalRequestFrom}" rendered="#{bean.createdByExternalUser}"
                      style="font-size: 20px"/>
        </div>
        <p:outputPanel id="btn_line">
            <div class="btn_line">
                <p:commandButton action="#{bean.viewExtraCost}" value="#{msg.requestCost}"
                                 styleClass="#{bean.examRequest.costButtonConfirmClicked ? '':'btn-green'}"
                                 update="btn_line, requestExtraCostDialog" />
                <p:commandButton action="#{bean.printSpecialPdf}" value="#{bean.createdByExternalUser
                                 ? msg.requestPrintRequestEventExternal : msg.requestPrintRequestEvent}"
                                 update="requestDocumentTable, btn_line" rendered="#{bean.examRequest.confirmExtraCostsPressed}"
                                 oncomplete="PF('requestDocumentDlg').show();"/>
                <p:commandButton action="#{bean.openMailManagerEditor}" value="#{msg.sendEmail}" update="btn_line"
                                 rendered="#{!bean.createdByExternalUser and bean.examRequest.confirmExtraCostsPressed}" />
            </div>
        </p:outputPanel>

        <p:dialog header="#{msg.deleteConfirmationHeader}" widgetVar="salesdlg"
                  modal="true" resizable="false" effect="SLIDE">
            #{empty deleteMessage ? msg.deleteConfirmation : deleteMessage}<br/>
            <br/>
            <div>
                <p:commandButton value="#{msg.yes}" action="#{bean.deleteSalesEntity}"
                                 oncomplete="goToPreviousPage();PF('salesdlg').hide();"
                                 update="sales_dev,:form:messages"/>
                <p:commandButton value="#{msg.no}" onclick="PF('salesdlg').hide()"/>
            </div>

            <script>
                function goToPreviousPage() {
                    if (PF('tableWV').getPaginator().cfg.rowCount
                        % PF('tableWV').getPaginator().cfg.rows == 0) {
                        var page = PF('tableWV').getPaginator()
                            .getCurrentPage();
                        if (page > 0) {
                            PF('tableWV').getPaginator().setPage(
                                page - 1);
                        }
                    }
                    if (PF('salesTableWV').getPaginator().cfg.rowCount
                        % PF('salesTableWV').getPaginator().cfg.rows == 0) {
                        var page = PF('salesTableWV').getPaginator()
                            .getCurrentPage();
                        if (page > 0) {
                            PF('salesTableWV').getPaginator().setPage(
                                page - 1);
                        }
                    }
                }
            </script>
        </p:dialog>
        <ui:include src="../Dialogs/RequestDocumentListDialog.xhtml"/>
        <ui:include src="../Dialogs/RequestExtraCostDialog.xhtml"/>
    </ui:define>
</ui:composition>
</html>
