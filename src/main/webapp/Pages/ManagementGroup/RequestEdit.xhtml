<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ff="http://readytech.com/functions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/resources/tpl/Admin/ViewBase.xhtml">
    <ui:param name="bean" value="#{requestEditBean}"/>
    <ui:param name="requestBean" value="#{requestListBean}"/>
    <ui:param name="view_title" value="#{bean.entity.isNew ? msg.requestNew : msg.requestEdit}"/>
    <ui:param name="goBackRendered" value="false"/>

    <ui:define name="view_body">
        <style>
            .select-width {
                width: 100% !important;
            }

            body .ui-button {
                margin-right: 3px !important;
                background: #3582b8;
            }

            body .ui-widget-header {
                background-color: #788FA7 !important;
                color: #ffffff;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem a {
                color: #6c757d;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem.ui-state-active {
                background: #FFFFFF !important;
                border-bottom: 2px solid #2196F3 !important;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem.ui-state-active a {
                color: #2196F3 !important;
            }

            body .ui-widget, body .ui-widget .ui-widget {
                font-family: "Open Sans","Helvetica Neue",sans-serif !important;
                text-decoration: none !important;
                font-size: 14px;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem {
                list-style: none;
                white-space: nowrap;
                display: inline-block;
                vertical-align: top;
                float: none;
                background: #ffffff !important;
                margin: 0;
                cursor: pointer;
                display: -ms-flexbox;
                display: flex;
                -ms-flex-align: center;
                align-items: center;
                transition: background-color 0.2s, color 0.2s, border-color 0.2s, box-shadow 0.2s;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem {
                border: none;
            }

            body .ui-tabmenu .ui-tabmenu-nav .ui-tabmenuitem.ui-state-hover {
                border-bottom: 2px solid gray !important;
            }

            body .ui-tabmenu .ui-tabmenu-nav {
                background: #ffffff !important;
                border-bottom: 2px solid #dee2e6 !important;
            }

            body .ui-inputfield {
                font-size: 14px !important;
                border: 1px solid #a8acb1;
            }

            body .ui-selectonemenu {
                border: 1px solid #a8acb1;
            }

            body .ui-radiobutton .ui-radiobutton-box {
                border: 1px solid #a8acb1;
            }

            body .ui-selectonemenu.ui-state-hover {
                border: 1px solid #5f666c !important;
            }

            body .ui-inputfield.ui-state-hover {
                border: 1px solid #5f666c;
            }

            body .ui-selectcheckboxmenu {
                border: 1px solid #a8acb1;
            }

            body .ui-panel .ui-panel-content {
                border: 1px solid #c9cdd2;
            }
            .nav-button {
                background-color: #000066 !important;
            }
            body .ui-button.ui-button-success {
                background: #00CC52 !important;
            }
            #changeUserDlg {
                border: 2px solid #57c279;
            }
            #changeUserDlg .ui-dialog-titlebar {
                border-bottom: none;
                background: #f8f9fa !important;
                color: #000;
            }
            .dynamic-fields input{
                width : 98% !important;
            }

            body .custom-design-tooltip .ui-tooltip-text {
                background: #D9E0E7;
                color: #6688AA;
                border: 10px solid #68a;
                border-radius: 10px;
                padding: 10px !important;
                box-shadow: none;
                position: relative;
                top: 20px;
                min-width: 220px !important;
            }

            body .custom-design-tooltip .ui-tooltip-arrow {
                display: none;
            }

            body a {
                color: #003871 !important;
            }
            #requestSaved .ui-dialog-titlebar.ui-widget-header {
                display: none;
            }
            #requestSaved .ui-dialog-content.ui-widget-content {
                padding-top: 25px;
            }
            #requestSaved_modal {
                background: rgba(255, 255, 255, 0.6) !important;
            }

            #multipleServiceRequest .ui-inputfield.ui-state-hover{
                border: none !important;
            }
            #multipleServiceRequest .ui-inputfield.ui-state-hover{
                border: none !important;
            }

            #table_paginator_top, #table_paginator_bottom {
                text-align: center;
                padding-bottom: 4px !important;
                padding: 8px 35px;
            }

            .ui-paginator-rpp-options {
                float: left;
                margin-top: 6px !important;
            }

            .ui-paginator-current {
                margin-top: 2px !important;
            }

            body .ui-paginator .ui-paginator-pages .ui-paginator-page.ui-state-active {
                background: #FFF !important;
                color: #000000 !important;
            }

            #table table {
                margin-top: 20px;
                padding-left: 13px;
                padding-right: 13px;
                border-collapse: separate;
                border-spacing: 0 0.6em;
            }

            body .ui-datatable:not(.borderless) thead th {
                background-color: #D9E0E7 !important;
                border-color: #808080 !important;
                color: #5f666c !important;
                padding: 8px 2px !important;
                border-width: 1px!important;
                border-style: solid!important;
            }


            #table_data td {
                color: #003871;
                border-top: none;
                border-bottom: none;
                background-color: #ffffff !important;
            }

            #table_data td:nth-child(1) {
                border-left: none;
                border-top-left-radius: 5px;
                border-bottom-left-radius: 5px;
                vertical-align: top;
            }

            #table_data td:last-child {
                border-right: none;
                border-top-right-radius: 5px;
                border-bottom-right-radius: 5px;
                -webkit-box-shadow: 4px 0px 7px -2px rgba(0, 0, 0, 0.75);
                -moz-box-shadow: 4px 0px 7px -2px rgba(0, 0, 0, 0.75);
                box-shadow: 4px 0px 7px -2px rgba(0, 0, 0, 0.75);
            }

            #table_data tr {
                background-color: transparent !important;
                border-top: none;
                -webkit-box-shadow: 0px 4px 7px -2px rgba(0, 0, 0, 0.75);
                -moz-box-shadow: 0px 4px 7px -2px rgba(0, 0, 0, 0.75);
                box-shadow: 0px 4px 7px -2px rgba(0, 0, 0, 0.75);
            }

            #table_data tr {
                margin-bottom: 8px;
                border-left: none;
            }

            #table_data {
                border: none;
                background: transparent;
            }

            body .ui-widget, body .ui-widget .ui-widget {
                font-weight: 400 !important;
            }

            .status-icon {
                height: 24px;
                width: 142px;
                padding-right: 4px;
                padding-left: 4px;
                border-radius: 10px;
                text-align: center;
                box-sizing: border-box;
                font-size: 12px;
                font-weight: 600;
                font-family: 'Mukta', sans-serif;
            }

            .status-green {
                border: 2px solid #00C347;
                color: #00C347;
            }
            #newRequestList_content .ui-panelgrid-cell.ui-grid-col-12 {
                padding: 1rem 0px;
            }
            .h35.ui-selectcheckboxmenu-multiple .ui-selectcheckboxmenu-multiple-container {
                height: 35px !important;
            }
            .h38 {
                height: 38px;
            }
            .h38 .ui-selectonemenu-label {
                padding: 0.6rem 0.5rem !important;
            }
            .ih36 .ui-inputfield.ui-inputtext{
                height: 36px;
                width: 100% !important;
            }
            .select-width, .ih36 {
                margin-bottom: 20px;
            }
            .input-width {
                width: 100% !important;
            }
        </style>

        <script>
            function next(activeMenu, totalTabs) {
                var nextMenu = activeMenu + 1;
                PrimeFaces.ab({s:"pageTabMenu",u:"form",g:false,pa:[{name:"pageTabMenu_menuid",value:nextMenu.toString()}],f:"form"});return false;
            }

            function previous(activeMenu, totalTabs) {
                var previousMenu = activeMenu - 1;
                PrimeFaces.ab({s:"pageTabMenu",u:"form",g:false,pa:[{name:"pageTabMenu_menuid",value:previousMenu.toString()}],f:"form"});return false;
            }
            jQuery(document).ready(function() {
                $(".ui-g-3").each(function()
                {
                    if($(this).children().length == 0)
                    {
                        $(this).hide();
                    }
                });
            });
            var time;

            function setTimer() {
                time=setTimeout(function(){ PF('saveDlgWV').hide()},2000);
            }

            function stopTimer() {
                clearTimeout(time);
            }
        </script>
        <p:remoteCommand name="updateSubjects" update="form"/>

        <p:tabMenu activeIndex="#{bean.activeMenuTabNum}" model="#{bean.topMenuModel}" style="background-color:#FFFFFF !important;"
                   id="pageTabMenu"  />
        <ui:fragment rendered="#{bean.multipleCreate and bean.activeMenuTabNum==0}">
            <div class="ui-g">
                <div class="ui-g-12" style="padding: 1%; background: transparent">
                    <ui:include src="#{bean.multipleTabPath}"/>
                </div>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{(bean.multipleCreate and bean.activeMenuTabNum==1)
        or(!bean.multipleCreate and bean.activeMenuTabNum==0)}">
            <p:panelGrid columns="4" styleClass="ui-panelgrid-blank form-group" layout="grid" id="initialTab"
                         style="margin-top: 1%">
                <p:column>
                    <span> #{msg.requestClient}<span class="red">*</span>:</span><br/>
                    <p:selectOneMenu id="client" value="#{bean.selectedClientId}"
                                     label="#{msg.requestClient}" styleClass="select-width h38">
                        <p:ajax listener="#{bean.onClientChange(false)}"
                                update="invoicesRecipient, branchPanel, officePanel, gestore"/>
                        <f:selectItems value="#{bean.clients}"/>
                    </p:selectOneMenu>
                    <p:outputPanel id="branchPanel" rendered="#{bean.isClientHasArea}">
                        <br/>
                        <h:outputText value="#{msg.requeBranch}: #{bean.areaOfClient}" rendered="#{bean.isClientHasArea}"/>
                    </p:outputPanel>
                    <p:outputPanel id="officePanel" rendered="#{bean.isClientHasArea}">
                        <br/>
                        <h:outputText value="#{msg.requeOffice}: #{bean.officeOfClient}" rendered="#{bean.isClientHasArea}"/>
                    </p:outputPanel>
                    <span>#{msg.titleOffice}</span><br/>
                    <p:selectOneMenu id="mail_ofice_id" value="#{bean.selectedOfficeId}"  styleClass="select-width" style="height: 37px;">
                        <f:selectItems value="#{bean.officeList}"/>
                    </p:selectOneMenu>
                    <br/>
                    <c:forEach items="#{bean.mutipleRequestFirstObjTabPath}" var="objItem">
                        <div class="#{(objItem.contains('NOTE') or objItem.contains('POSITION_PRACTICE')) ? 'ui-g-12' :'ui-g-6'} ih36" style="padding: 0">
                            <ui:include src="#{objItem}"/>
                        </div>
                    </c:forEach>
                </p:column>
                <p:column>
                    <span>#{msg.requestInvoicesRecipient}:</span><br/>
                    <p:selectOneMenu id="invoicesRecipient" styleClass="select-width h38"
                                     value="#{bean.selectedBillingClientId}"
                                     label="#{msg.requestInvoicesRecipient}">
                        <f:selectItems value="#{bean.billingClients}"/>
                        <p:ajax listener="#{bean.onAgencyChange}"/>
                    </p:selectOneMenu>
                    <br/>

                    <span>#{msg.clientManager}</span>
                    <p:selectCheckboxMenu id="gestore" value="#{bean.fiduciaryClientsSelected}"
                                          styleClass="select-width h35"
                                          label="#{enums.documentGenerationTagsMANAGER}"
                                          converter="#{bean.clientSelectItemWrapperConverter}"
                                          multiple="true" filter="true" filterMatchMode="startsWith" >
                        <f:selectItems value="#{bean.fiduciaryClients}" var="con" itemValue="#{con}"
                                       itemLabel="#{con.label}"/>
                        <p:ajax process="gestore"/>
                    </p:selectCheckboxMenu>
                    <c:forEach items="#{bean.mutipleRequestNDGPath}" var="objItem">
                        <div class="ih36" style="padding: 0">
                            <ui:include src="#{objItem}"/>
                        </div>
                    </c:forEach>

                </p:column>
                <p:column rendered="#{!bean.multipleRequestCreate}">
                    <span> #{msg.requestRequestType}<span class="red">*</span>:</span><br/>
                    <p:selectOneMenu id="requestType" value="#{bean.selectedRequestTypeId}"
                                     label="#{msg.requestRequestType}" styleClass="select-width">
                        <p:ajax listener="#{bean.onRequestTypeChange}"
                                update="#{bean.multipleCreate?'multipleService':'service'}"/>
                        <f:selectItems value="#{bean.requestTypes}"/>
                    </p:selectOneMenu>
                </p:column>
                <p:column rendered="#{!bean.multipleRequestCreate}">
                    <span> #{msg.requestService}<span class="red">*</span>:</span><br/>
                    <p:selectOneMenu value="#{bean.selectedServiceId}" rendered="#{!bean.multipleCreate}"
                                     label="#{msg.requestService}" styleClass="select-width h38" id="service">
                        <p:ajax listener="#{bean.onServiceChange}" update="form"/>
                        <f:selectItems value="#{bean.services}"/>
                    </p:selectOneMenu>
                    <p:selectCheckboxMenu value="#{bean.selectedServiceIds}" id="multipleService"
                                          rendered="#{bean.multipleCreate}" label="#{msg.requestService}"
                                          styleClass="select-width h38">
                        <f:selectItems value="#{bean.services}"/>
                    </p:selectCheckboxMenu>
                </p:column>
                <p:column rendered="#{bean.multipleRequestCreate}">
                    <span> #{msg.requestNotary}</span><br/>
                    <p:selectOneMenu id="requestNotary" styleClass="select-width h38"
                                     value="#{bean.selectedNotaryId}"
                                     label="#{msg.requestNotary}">
                        <f:selectItems value="#{bean.notaryList}"/>
                    </p:selectOneMenu>
                    <span> #{msg.clientTypeTrust}</span><br/>
                    <p:selectOneMenu id="clientTypeTrust" styleClass="select-width h38"
                                     value="#{bean.selectedFiduciaryId}"
                                     label="#{msg.clientTypeTrust}">
                        <f:selectItems value="#{bean.fiduciaryList}"/>
                    </p:selectOneMenu>
                    <c:forEach items="#{bean.mutipleRequestObjTabPath}" var="objItem">
                        <div class="ui-g-12 ih36" style="padding: 0">
                            <ui:include src="#{objItem}"/>
                        </div>
                    </c:forEach>
                </p:column>

            </p:panelGrid>

            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid" id="requstType" rendered="#{bean.requestType eq null || bean.requestType eq -1}">
                <p:selectOneRadio value="#{bean.selectedRequestEnumTypeFirst}" styleClass="request-select-radio">
                    <p:ajax update="requstType"/>
                    <f:selectItems value="#{bean.requestEnumTypesFirst}"/>
                </p:selectOneRadio>
                <p:selectOneRadio id="requestTypeSecond" rendered="#{bean.selectedRequestEnumTypeFirst==2}"
                                  value="#{bean.selectedRequestEnumTypeSecond}" styleClass="request-select-radio">
                    <f:selectItems value="#{bean.requestEnumTypesSecond}"/>
                </p:selectOneRadio>
            </p:panelGrid>
        </ui:fragment>

        <ui:fragment id="dynamicFragment" rendered="#{(bean.multipleRequestCreate and bean.activeMenuTabNum==bean.topMenuModel.getElements().size() - 2 ) or (!bean.multipleRequestCreate and not empty bean.shownFields)}">
            <div class="dynamic-fields">
                <c:if test="#{bean.multipleRequestCreate}">
                    <div class="ui-g">
                        <div class="ui-g-3" style="padding: 1%">
                            <span> #{msg.requestRequestType}<span class="red">*</span>:</span><br/>
                            <p:selectOneMenu id="servicerequestType" value="#{bean.selectedRequestTypesIdMultiple}"
                                             label="#{msg.requestRequestType}" styleClass="select-width" style="min-height: 37px;">
                                <p:ajax delay="500" event="change" listener="#{bean.onRequestTypeChangeBlock}"
                                        update="form @this"/>
                                <f:selectItems value="#{bean.requestTypes}"/>
                            </p:selectOneMenu>
                        </div>

                        <h:panelGroup styleClass="ui-g-3" style="padding: 1%" rendered="#{!bean.requestTypeMultiple}">
                            <span> #{msg.requestService}<span class="red">*</span>:</span><br/>
                            <p:selectOneMenu id="singleServiceRequest" value="#{bean.selectedServiceId}"
                                             label="#{msg.requestRequestType}" styleClass="select-width" style="min-height: 37px;">
                                <p:ajax delay="2000" event="change" listener="#{bean.onMultipleServiceChanges()}"
                                        update="form @this" />
                                <f:selectItem itemValue="" itemLabel="- Non selezionato -" />
                                <f:selectItems value="#{bean.services}"/>
                            </p:selectOneMenu>

                        </h:panelGroup>

                        <h:panelGroup styleClass="ui-g-3" style="padding: 1%" rendered="#{bean.requestTypeMultiple}">
                            <span> #{msg.requestService}<span class="red">*</span>:</span><br/>
                            <p:selectCheckboxMenu value="#{bean.selectedServiceIds}" id="multipleServiceRequest" multiple="true"
                                                  label="#{msg.requestService}"
                                                  styleClass="select-width" style="min-height: 37px;">
                                <p:ajax delay="2000" event="change" listener="#{bean.onMultipleServiceChanges()}" update="form @this" />
                                <f:selectItems value="#{bean.services}"/>
                            </p:selectCheckboxMenu>
                        </h:panelGroup>
<!--                        <div class="ui-g-3" style="padding: 1%">-->

<!--                        </div>-->
                        <div style="padding-top: 1%;">
<!--                            <p:commandButton id="confirmButton" value="#{msg.submit}"-->
<!--                                             update="form @this" style="margin-top: 16px;"-->
<!--                                             styleClass="ui-button-success"-->
<!--                                             action="#{bean.generateDynamicContent(true)}"-->
<!--                                             rendered="#{bean.showConfirmButton}"/>-->
                        </div>
                        <div id="request-btns" style="padding-top: 1%;">
                            <p:commandButton style="margin-top: 20px;"
                                             id="addRequestService"
                                             action="#{bean.validateMultipleRequest(false)}"
                                             value="#{msg.addRequestService.toUpperCase()}"
                                             icon="fa fa-floppy-o" styleClass="ui-button-success" iconPos="left"
                                             update="saveMultipleRequest table newRequestList servicerequestType multipleServiceRequest form"
                                             disabled="#{bean.selectedRequestTypesIdMultiple eq null}"
                                             rendered="#{bean.showAddServiceButton and bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-2
                                                            and bean.multipleRequestCreate}"/>
                            <div style="clear: both"></div>
                        </div>
                    </div>
                </c:if>
<!--                <c:forEach rendered="#{not empty bean.shownFields}" items="#{bean.shownFields}" var="item">-->
<!--                    <div class="ui-g" style="#{item.getLineEven()?'background-color: #F5F5F5;':''}">-->
<!--                        <c:if test="#{item.field != null}">-->
<!--                            <div class="ui-g-12" style="padding: 1%; background: transparent">-->
<!--                                <ui:include src="#{item.field.field.getPath()}"/>-->
<!--                            </div>-->
<!--                        </c:if>-->
<!--                        <c:if test="#{(item.fields != null) and item.isAttachedDocumentsBlock()}">-->
<!--                            <c:forEach items="#{item.fields}" var="block">-->
<!--                                <div class="ui-g-6" style="padding: 1%">-->
<!--                                    <ui:include src="#{block.field.getPath()}"/>-->
<!--                                </div>-->
<!--                            </c:forEach>-->
<!--                        </c:if >-->
<!--                        <c:if test="#{(item.fields != null) and !item.isAttachedDocumentsBlock()}">-->
<!--                            <c:forEach items="#{item.fields}" var="block">-->
<!--                                <div class="ui-g-3" style="padding: 1%">-->
<!--                                    <ui:include src="#{block.field.getPath()}"/>-->
<!--                                </div>-->
<!--                            </c:forEach>-->
<!--                        </c:if>-->
<!--                    </div>-->
<!--                </c:forEach>-->
                <p:outputPanel id="dynamicPanel">
                    <c:forEach rendered="#{not empty bean.shownFields}" items="#{bean.shownFields}" var="item">
                        <div class="ui-g" style="#{item.getLineEven()?'background-color: #F5F5F5;':''}">
                            <c:if test="#{item.field != null}">
                                <div class="ui-g-12" style="padding: 1%; background: transparent">
                                    <ui:include src="#{item.field.field.getPath()}"/>
                                </div>
                            </c:if>
                            <c:if test="#{(item.fields != null) and item.isAttachedDocumentsBlock()}">
                                <c:forEach items="#{item.fields}" var="block">
                                    <div class="ui-g-6" style="padding: 1%">
                                        <ui:include src="#{block.field.getPath()}"/>
                                    </div>
                                </c:forEach>
                            </c:if >
                            <c:if test="#{(item.fields != null) and !item.isAttachedDocumentsBlock()}">
                                <c:forEach items="#{item.fields}" var="block">
                                    <div class="ui-g-3" style="padding: 1%">
                                        <ui:include src="#{block.field.getPath()}"/>
                                    </div>
                                </c:forEach>
                            </c:if>
                        </div>
                    </c:forEach>
                </p:outputPanel>
            </div>
        </ui:fragment>

        <ui:fragment rendered="#{(bean.multipleRequestCreate and bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-1) or (!bean.multipleRequestCreate and bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-1)}">
            <p:panel id="userAddPanel" style="margin-top: 1%">
                <span>#{msg.requestUserChange}:</span><br/>
                <ui:fragment rendered="#{!empty bean.entity.userName}">
                    <span><i class="fa fa-user"/></span>
                </ui:fragment>
                <h:outputText value="#{bean.entity.userName}"/>
                <br/>

                <p:commandButton value="#{msg.requestUserChangeBtn}" oncomplete="PF('changeUserDlgWV').show();"
                                 styleClass="grey-btn"/>
            </p:panel>
        </ui:fragment>

        <ui:fragment>
            <div class="ui-g">
<!--                <div class="ui-g-3" id="request-btns-4" style="margin-top:2%">-->
<!--                    <p:commandButton style="float: left"-->
<!--                                     value="#{msg.requestEntered}"-->
<!--                                     styleClass="ui-button-primary" iconPos="left"-->
<!--                                     rendered="#{bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-1 and bean.multipleRequestCreate}"-->
<!--                                     oncomplete="PF('requestubjectDlg').show();" update="requestubjectDlgId" actionListener="#{bean.openRequestSubjectDialog}"-->

<!--                    />-->
<!--                    <div style="clear: both"></div>-->
<!--                </div>-->
                <div class="ui-g-10" style="margin-top:2%"></div>
<!--                <div class="ui-g-2" id="request-btns" style="margin-top:2%">-->
<!--                    <p:commandButton style="float: right" action="#{bean.validateMultipleRequest(false)}" value="#{msg.save.toUpperCase()}"-->
<!--                                     icon="fa fa-floppy-o" styleClass="ui-button-success" iconPos="left" update="saveMultipleRequest table newRequestList servicerequestType multipleServiceRequest form"-->
<!--                                     rendered="#{bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-2 and bean.multipleRequestCreate}"/>-->
<!--                    <div style="clear: both"></div>-->
<!--                </div>-->
<!--                <div class="ui-g-2" id="request-btns-1" style="margin-top:2%;text-align:right;">-->
<!--                    <p:commandButton action="#{bean.validateMultipleRequest(true)}" value="#{bean.multipleRequestCreate ? msg.saveAndClose.toUpperCase() : msg.save.toUpperCase() }"-->
<!--                                     icon="fa fa-floppy-o" styleClass="ui-button-success" iconPos="left"-->
<!--                                     rendered="#{bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-2    }"/>-->

<!--                    <div style="clear: both"></div>-->
<!--                </div>-->
            </div>
        </ui:fragment>

<!--        <ui:include src="../Dialogs/RequestSubjectDialog.xhtml" />-->

        <p:dialog id="saveDlg" widgetVar="saveDlgWV" modal="true" onShow="setTimer();" onHide="stopTimer();"
                  resizable="false" draggable="false" effect="SLIDE">
            <p:outputLabel value="#{msg.requestListSave}"/>

        </p:dialog>

        <p:dialog id="changeUserDlg" widgetVar="changeUserDlgWV" modal="true"
                  resizable="false" draggable="false" effect="SLIDE"
                  header="#{msg.requestUserChangeDlg}">
            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid">
                <h:outputText value="#{msg.requestUserChangeMsg}:"/>
                <p:selectOneMenu id="changeUserList" value="#{bean.selectedUserId}" style="width: 91%;"
                                 label="#{msg.requestUserChangeMsg}">
                    <f:selectItems value="#{bean.users}"/>
                </p:selectOneMenu>
            </p:panelGrid>
            <div class="btn_line">
                <p:commandButton value="#{msg.yes}" action="#{bean.changeUser}"
                                 update="@form" oncomplete="PF('changeUserDlgWV').hide();"
                                 style="background-color: #57c279!important;"/>
                <p:commandButton value="#{msg.no}"
                                 oncomplete="PF('changeUserDlgWV').hide();" style="background-color: #F3362B !important;"/>
            </div>
        </p:dialog>

        <p:dialog id="saveMultipleRequest" widgetVar="multipleRequestSave" modal="true"
                  resizable="false" draggable="false" effect="SLIDE"
                  header="#{msg.requestUserChangeDlg}">
            <span>
                <h:outputText value="#{bean.multipleReqMessage}"/>
            </span>
            <div class="btn_line">
                <p:commandButton value="#{msg.yes}" action="#{bean.pageSave}"
                                 update="@form" oncomplete="PF('multipleRequestSave').hide();"/>
                <p:commandButton value="#{msg.no}"
                                 oncomplete="PF('multipleRequestSave').hide();"/>
            </div>
        </p:dialog>

        <p:dialog id="suspendDialog" widgetVar="suspendDialogWV" modal="true"
                  resizable="false" draggable="false" effect="SLIDE">
            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group">
                <h:outputText value="#{msg.requestSuspendReason}:" maxlength="500"/>
                <p:inputTextarea value="#{bean.reason}"/>
            </p:panelGrid>

            <div class="btn_line">
                <p:commandButton value="#{msg.requestSuspend}"
                                 action="#{bean.suspendRequest}" update="@form"
                                 oncomplete="PF('suspendDialogWV').hide();"/>
                <p:commandButton value="#{msg.cancel}"
                                 oncomplete="PF('suspendDialogWV').hide();"/>
            </div>
        </p:dialog>

        <p:dialog id="unsuspendDialog" widgetVar="unsuspendDialogWV"
                  modal="true" resizable="false" draggable="false" effect="SLIDE">
            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group">
                <h:outputText value="#{msg.requestSuspendReason}:"/>
                <p:inputTextarea value="#{bean.reasonUnsuspend}" maxlength="500"/>
            </p:panelGrid>

            <div class="btn_line">
                <p:commandButton value="#{msg.requestUnSuspend}"
                                 action="#{bean.unsuspendRequest}" update="@form"
                                 oncomplete="PF('unsuspendDialogWV').hide();"/>
                <p:commandButton value="#{msg.cancel}"
                                 oncomplete="PF('unsuspendDialogWV').hide();"/>
            </div>
        </p:dialog>

        <p:dialog id="reactivateDialog" widgetVar="reactivateDialogWV"
                  modal="true" resizable="false" draggable="false" effect="SLIDE">
            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group">
                <h:outputText value="#{msg.requestReactivateReason}:"/>
                <p:inputTextarea value="#{bean.reactivateReason}" maxlength="500"/>
            </p:panelGrid>

            <div class="btn_line">
                <p:commandButton value="#{msg.requestReactivate}"
                                 action="#{bean.reactivateRequest}" update="@form"
                                 oncomplete="PF('reactivateDialogWV').hide();"/>
                <p:commandButton value="#{msg.cancel}"
                                 oncomplete="PF('reactivateDialogWV').hide();"/>
            </div>
        </p:dialog>
        <p:dialog widgetVar="notifyUserDialogWV" modal="true" resizable="false" effect="SLIDE" id="notifyUserDialog">
            <h:outputText value="#{bean.notificationUser}"/>
            <br/>
            <br/>
            <div class="btn_line">
                <p:commandButton value="#{msg.edit}" oncomplete="PF('notifyUserDialogWV').hide()"
                                 rendered="#{bean.allEvaded and !bean.isServiceUpdate}"/>
                <p:commandButton value="#{msg.submit}" oncomplete="PF('notifyUserDialogWV').hide()"
                                 rendered="#{bean.isServiceUpdate}" action="#{bean.saveToDB(bean.entity, true)}"/>
                <p:commandButton value="#{bean.allEvaded ? msg.close : msg.submit }" oncomplete="PF('notifyUserDialogWV').hide()"
                                 action="#{bean.changeShouldBeRedirected(true)}"/>
            </div>
        </p:dialog>
        <p:dialog widgetVar="diffFiscalCodeWV" modal="true" resizable="false" effect="SLIDE" id="diffFiscalCodeDialog">
            <h:outputText value="#{msg.requestEditDiffFiscalCode}"/>
            <br/>
            <br/>
            <div class="btn_line">
                <p:commandButton value="#{msg.submit}" oncomplete="PF('diffFiscalCodeWV').hide()"/>
            </div>
        </p:dialog>
        <p:dialog id="requestSaved" widgetVar="requestSaved" modal="true" closable="false"
                  resizable="false" draggable="false" effect="SLIDE" style="border: 1px solid #00CC52;">
            <span>
                <h:outputText value="#{msg.requestListSave}"/>
            </span>
        </p:dialog>

    </ui:define>

    <ui:define name="view_buttons">
        <ui:fragment>
            <div style="margin: 2% 1% 1%;text-align: center">
                <ui:remove>
                    <p:commandButton value="#{msg.edit}" action="#{bean.editSubject}"
                                     update="@form"
                                     rendered="#{!bean.performEdit and bean.canEdit and !bean.entity.isNew}"/>
                </ui:remove>
                <!-- <p:commandButton value="#{msg.requestSuspend}"
                                  rendered="#{!bean.entity.isNew and !bean.isSuspend and bean.canSuspendRequest}"
                                  oncomplete="PF('suspendDialogWV').show();"/>
                 <p:commandButton value="#{msg.requestUnSuspend}"
                                  rendered="#{!bean.entity.isNew and bean.isSuspend and bean.canSuspendRequest}"
                                  oncomplete="PF('unsuspendDialogWV').show();"/>-->
                <p:commandButton value="#{msg.requestReactivate}"
                                 rendered="#{!bean.entity.isNew and bean.isSuspend}"
                                 oncomplete="PF('reactivateDialogWV').show();"/>
                <p:commandButton value="#{msg.requestManageEstateLocation}"
                                 action="#{bean.openEstateLocation}" rendered="#{bean.editRequest }"/>
                <p:commandButton value="#{msg.requestManagePrint}"
                                 action="#{bean.generatePdf}" rendered="#{bean.editRequest}"/>
            </div>
        </ui:fragment>
        <ui:fragment id="buttonFragment">
            <div class="ui-g">
                <div class="ui-g-12">
                    <div class="ui-g-6" style="text-align:left;">
                        <p:commandButton id="previousButton" value="#{msg.previous}" rendered="#{bean.activeMenuTabNum != 0}" update="@form :buttonFragment"
                                         onclick="previous(#{bean.activeMenuTabNum}, #{bean.topMenuModel.getElements().size()-1});" icon="fa fa-arrow-left" styleClass="nav-button"/>
                    </div>
                    <div class="ui-g-6" style="text-align:right;">
                        <p:commandButton id="nextButton" value="#{msg.next}" rendered="#{bean.activeMenuTabNum != bean.topMenuModel.getElements().size()-1}" update="@form :buttonFragment"
                                         onclick="next(#{bean.activeMenuTabNum}, #{bean.topMenuModel.getElements().size()-1});"  icon="fa fa-arrow-right" styleClass="nav-button"/>
                    </div>
                </div>
            </div>
        </ui:fragment>

        <ui:fragment id="requestListFragment" rendered="#{(bean.multipleRequestCreate and bean.activeMenuTabNum==bean.topMenuModel.getElements().size() - 2 ) or (!bean.multipleRequestCreate and not empty bean.shownFields)}">
<!--                <ui:repeat var="req" value="#{bean.regSubjectList}" varStatus="requestIndex">-->
<!--                    <p:panelGrid columns="4" styleClass="ui-panelgrid-blank form-group" layout="grid" id="serviceList">-->
<!--                        <p:selectOneMenu id="subjectServicerequestType" value="#{req.requestTypeId}"-->
<!--                                         label="#{msg.requestRequestType}" styleClass="select-width" style="min-height: 37px;" disabled="true">-->
<!--                            <f:selectItems value="#{bean.requestTypes}"/>-->
<!--                        </p:selectOneMenu>-->
<!--                        <p:selectCheckboxMenu value="#{bean.subjectListServiceIds.get(req.id)}" multiple="true"-->
<!--                                              label="#{msg.requestService}"-->
<!--                                              styleClass="select-width" style="min-height: 37px;" disabled="true">-->
<!--                            <f:selectItems value="#{bean.subjectListServices.get(req.requestTypeId)}"/>-->
<!--                        </p:selectCheckboxMenu>-->
<!--                    </p:panelGrid>-->
<!--                </ui:repeat>-->

            <p:panelGrid columns="1" styleClass="ui-panelgrid-blank form-group" layout="grid" id="newRequestList">
                <p:dataTable var="item" id="table" style="height: 98%" rendered="#{!bean.regSubjectList.isEmpty()}"
                             emptyMessage="#{msg.noRecordsFound}" value="#{bean.regSubjectList}"
                             rowKey="#{item.id}" rows="10" lazy="true" paginator="true"
                             paginatorAlwaysVisible="true" rowIndexVar="rowId"
                             paginatorTemplate="&lt;span style='float: left;margin-top: 7px;'&gt;Elementi visibili nella pagina&lt;/span&gt; {RowsPerPageDropdown}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {CurrentPageReport}"
                             currentPageReportTemplate="Pagina {currentPage} di {totalPages}"
                             rowsPerPageTemplate="10,20,50" widgetVar="tableWV" styleClass="request-table">

                    <p:column headerText="#{ff:upper(msg.requestListDate)}" sortBy="#{item.createDate}"
                              style="width: 7vw;min-width: 163px;text-align: center;">
                        <p:outputPanel style="margin-left: 10px;text-align: left;max-height: 80px;">
                            <h:outputText value="#{item.createDate}" converter="dateTimeConverter"
                                          style="color:#003871;font-weight: bold !important;"/>
                            <br/>
                            <h:outputText value="#{item.createDate}" converter="timeConverter" style="color:#003871;"/>
                            <br/>
                            <br/>
                            <h:outputText
                                    value="#{not empty item.stateDescription ? ff:upper(item.stateDescription) : ''}"
                                    styleClass="#{item.stateDescription eq 'Inserita'
			                        ? 'status-icon status-green' : (item.stateDescription eq 'In lavorazione' ? 'status-icon status-yellow' :(item.stateDescription eq 'Da inviare' ? 'status-icon status-navy' : (item.stateDescription eq 'Sospesa' ? 'status-icon status-magenta' : (item.stateDescription eq 'Evasa' ? 'status-icon status-red': (item.stateDescription eq 'Inviata allo SDI' ? 'status-icon status-cyan': (item.stateDescription eq 'Fatturata' ? 'status-icon state-blue': ''))))))}"/>
                            <br/>
                            <h:outputText rendered="#{item.urgent}" styleClass="vertical-txt"
                                          value="#{ff:upper(msg.requestListUrgent)}"/>
                            <br/>
                        </p:outputPanel>
                    </p:column>


                    <p:column style="width: 9vw;min-width: 159px;position: relative"
                              headerText="#{ff:upper(msg.requestListClient)}">
                        <p:outputPanel>
                            <h:outputText value="#{item.clientName}"/>
                        </p:outputPanel>
                        <br/>
                        <p:graphicImage id="info" url="/resources/images/tooltip.png"
                                        style="height :25px;bottom: 5px;position: absolute;"
                                        rendered="#{not empty item.mailId and (not empty item.fiduciaryId or not empty item.managerId)}"/>
                        <p:tooltip for="info" styleClass="custom-design-tooltip">
                            <h:outputText value="#{ff:upper(msg.requestManagers)}"
                                          style="font-weight:bold;color:#003871;"/>
                            <br/>
                            <h:outputText value="#{item.haveManagers()}" escape="false"
                                          rendered="#{not empty item.haveManagers()}"/>
                            <br/>
                            <h:outputText value="#{ff:upper(msg.requestTrustees)}"
                                          style="font-weight:bold;color:#003871;"/>
                            <br/>
                            <h:outputText value="#{item.getClientNameProfessional(item.fiduciaryId)}" escape="false"
                                          rendered="#{not empty item.fiduciaryId}" style="color:#003871;"/>
                        </p:tooltip>
                    </p:column>

                    <p:column headerText="#{ff:upper(msg.requestListServiceCap)}" styleClass="min_padding_margin"
                              style="width: 13.1vw;min-width: 180px;">
                        <p:outputPanel style="margin-left: 20px;text-align: left;">
                            <p:outputPanel id="servicesColumn"
                                           rendered="#{item.serviceName eq null}"
                                           style="background-color: transparent;width: inherit;"/>
                            <p:outputPanel>
                                <h:outputText styleClass="#{requestBean.getItemIconStyleClass(item.requestTypeId)}"
                                              style="display: inline-flex;margin-right: 5px;"/>
                                <h:outputText id="requestTypeName" value="#{item.requestTypeName}"
                                              style="vertical-align: top;font-weight: bold !important;"
                                              rendered="#{item.requestTypeName ne null}"/>
                            </p:outputPanel>
                            <h:outputText id="service" value="#{item.serviceName}"
                                          rendered="#{item.serviceName ne null}"/>
                            <br/>
                            <p:graphicImage id="multipleservice" url="/resources/images/tooltip.png"
                                            style="height :25px;margin-top: -9px;margin-left: -20px;position: absolute;"
                                            rendered="#{not empty item.multipleServices}"/>
                            <p:tooltip for="multipleservice" styleClass="custom-design-tooltip"
                                       rendered="#{not empty item.multipleServices}">
                                <ui:repeat var="ele" value="#{item.multipleServices}" varStatus="service">
                                    <h:outputText value="#{ele}" escape="false"
                                                  style="color:#003871;margin-left: 24px;"/>
                                    <br/>
                                </ui:repeat>
                            </p:tooltip>
                        </p:outputPanel>

                    </p:column>


                    <p:column rendered="false" style="width: 100px;min-width: 100px;"
                              headerText="#{ff:upper(msg.requestLastBusinessName)}" sortBy="#{item.name}">
                        <p:commandLink value="#{ff:upper(item.nameStr)}" rendered="#{item.subjectId ne null}"
                                       action="#{requestBean.openRequestSubject}" style="cursor: pointer;">
                            <f:setPropertyActionListener value="#{item.subjectId}"
                                                         target="#{requestBean.entityEditId}"/>
                        </p:commandLink>
                        <h:outputText value="#{ff:upper(item.nameStr)}" rendered="#{item.subjectId eq null}"/>
                    </p:column>

                    <p:column headerText="#{ff:upper(msg.requestNameFiscalCodeVATNumber)}"
                              style="width: 13.1vw;min-width: 180px;"
                              sortBy="#{item.code}">
                        <p:commandLink value="#{ff:upper(item.nameStr)}" rendered="#{item.subjectId ne null}"
                                       action="#{requestBean.openRequestSubject}" style="cursor: pointer;">
                            <f:setPropertyActionListener value="#{item.subjectId}"
                                                         target="#{requestBean.entityEditId}"/>
                        </p:commandLink>
                        <h:outputText value="#{ff:upper(item.nameStr)}" rendered="#{item.subjectId eq null}"/>
                        <br/>
                        <h:outputText value="#{item.code}" style="color:#003871"/>
                    </p:column>
                    <p:column headerText="#{ff:upper(msg.requestListCorservatoryName)}"
                              style="width: 9vw;min-width: 159px;text-align: center;">
                        <h:outputText value="#{item.aggregationLandCharRegNameOrCity}"/>
                    </p:column>
                    <p:column styleClass="min_padding_margin" headerText="#{ff:upper(msg.requestListCurrentOperator)}"
                              rendered="#{!requestBean.getCurrentUser().isExternal()}"
                              style="width: 8.3vw;min-width: 177px;">
                        <h:outputText value="#{item.userName}"/>
                    </p:column>

                    <p:column style="width: 6vw;min-width: 125px;text-align: center;"
                              headerText="#{ff:upper(msg.expirationDateCap)}" sortBy="#{item.expirationDate}"
                              rendered="#{!requestBean.getCurrentUser().isExternal()}">
                        <h:outputText value="#{item.expirationDate}" converter="dateTimeConverter"/>
                    </p:column>

                    <p:column style="width: 4vw;min-width: 81px;" headerText="#{ff:upper(msg.requestListOpenMail)}">
                        <p:outputPanel
                                style="#{not item.external and empty item.mailId and not item.haveAllegatiDocuments ? 'text-align: center;' : 'display: flex;'}">
                            <p:commandButton id="mailBtn" styleClass="richiesta-da-mail-icon"
                                             action="#{requestBean.openRequestMail}"
                                             style="color: transparent;background-color: transparent;border-color: transparent;margin: 0 auto;cursor: pointer;"
                                             rendered="#{not empty item.mailId}">
                                <f:setPropertyActionListener value="#{item.mailId}"
                                                             target="#{requestBean.entityEditId}"/>
                            </p:commandButton>
                            <p:tooltip for="mailBtn" value="#{item.mailSubject}"/>

                            <h:outputText id="externalUserIcon"
                                          rendered="#{item.external and not item.haveAllegatiDocuments}"
                                          style="margin: 0 auto;" styleClass="richiesta-da-clienti-icon"/>
                            <p:tooltip for="externalUserIcon" value="#{item.createUserFullName}" escape="false"/>

                            <p:outputPanel rendered="#{item.external and item.haveAllegatiDocuments}"
                                           style="display: flex;margin-left: calc( 50% - 15px );">
                                <p:commandButton id="externalUserIconA" styleClass="richiesta-da-clienti-icon"
                                                 action="#{requestBean.loadAllegatiDocuments}" update="requestDocs"
                                                 style="color: transparent;background-color: transparent;border-color: transparent;margin: 0 auto;cursor: pointer;"
                                                 oncomplete="PF('documentDialog').show();">
                                    <f:setPropertyActionListener value="#{item.id}"
                                                                 target="#{requestBean.entityEditId}"/>
                                </p:commandButton>
                                <p:tooltip for="externalUserIconA" value="#{item.createUserFullName}" escape="false"/>
                                <h:outputText value="A"
                                              style="width: 19px;height: 20px;background-color: #003871;border-radius: 50%;color: white;display: block;margin-top: -10px;margin-left: -6px;text-align: center;"/>
                            </p:outputPanel>


                            <p:graphicImage id="internalUserIcon"
                                            url="/resources/images/richiesta-da-operatore-getesi.png"
                                            style="height :28px;"
                                            rendered="#{not item.external and empty item.mailId and not item.haveAllegatiDocuments}"/>
                            <p:tooltip for="internalUserIcon" value="#{item.createUserFullName}" escape="false"/>

                            <p:outputPanel style="display: flex;#{empty item.mailId ? 'margin-left: 38%;' : ''}"
                                           rendered="#{not item.external and empty item.mailId and item.haveAllegatiDocuments}">
                                <p:commandButton id="internalUserIconA" value="G"
                                                 action="#{requestBean.loadAllegatiDocuments}" update="requestDocs"
                                                 styleClass="g-btn"
                                                 style="background-color: transparent !important;display: block;width: 24px;height: 24px;border: 2px solid;border-radius: 50%;color: #003871;margin: 0 auto;cursor: pointer;"
                                                 oncomplete="PF('documentDialog').show();">
                                    <f:setPropertyActionListener value="#{item.id}"
                                                                 target="#{requestBean.entityEditId}"/>
                                </p:commandButton>
                                <p:tooltip for="internalUserIconA" value="#{item.createUserFullName}" escape="false"/>
                                <h:outputText value="A"
                                              style="width: 19px;height: 20px;background-color: #003871;border-radius: 50%;color: white;display: block;margin-top: -10px;margin-left: -6px;text-align: center;"/>
                            </p:outputPanel>


                        </p:outputPanel>
                    </p:column>

                    <p:column styleClass=" action_midle_column al-cen-fx"
                              headerText="#{ff:upper(msg.requestListDocuments)}" style="width: 4vw;min-width: 81px;">
                        <p:outputPanel style="display: flex;" rendered="#{item.haveDocuments}">
                            <p:outputPanel style="display: flex;">
                                <p:commandButton styleClass="attachment-icon"
                                                 action="#{requestBean.loadRequestDocuments}" update="requestDocs"
                                                 style="color: transparent;background-color: transparent;border-color: transparent;margin: 0 auto;cursor: pointer;"
                                                 oncomplete="PF('documentDialog').show();">
                                    <f:setPropertyActionListener value="#{item.id}"
                                                                 target="#{requestBean.entityEditId}"/>
                                </p:commandButton>
                                <h:outputText value="#{item.documentsCount}"
                                              style="width: 19px;height: 20px;background-color: #003871;border-radius: 50%;color: white;display: block;margin-top: -10px;margin-left: -6px;text-align: center;"/>
                            </p:outputPanel>
                        </p:outputPanel>
                    </p:column>
                    <ui:remove>
                        <p:column styleClass=" min_padding_margin" headerText="#{ff:upper(msg.requestListOpenEditor)}"
                                  rendered="#{!requestBean.getCurrentUser().isExternal()}">
                            <p:commandButton icon="fa fa-indent" action="#{requestBean.openRequestEditor}">
                                <f:setPropertyActionListener value="#{item.id}" target="#{requestBean.entityEditId}"/>
                            </p:commandButton>
                        </p:column>
                    </ui:remove>
                </p:dataTable>
            </p:panelGrid>
        </ui:fragment>

        <ui:fragment>
            <div class="ui-g">
                <div class="ui-g-10" style="margin-top:2%"></div>
                <div class="ui-g-2" id="request-btns-1" style="margin-top:2%;text-align:right;">
                    <p:commandButton action="#{bean.validateMultipleRequest(true)}" value="#{bean.multipleRequestCreate ? msg.saveAndClose.toUpperCase() : msg.save.toUpperCase() }"
                                     icon="fa fa-floppy-o" styleClass="ui-button-success" iconPos="left"
                                     rendered="#{bean.activeMenuTabNum==bean.topMenuModel.getElements().size()-2    }"/>

                    <div style="clear: both"></div>
                </div>
            </div>
        </ui:fragment>
    </ui:define>

    <ui:define name="standard_validation_body">
        <p:fragment>
            <p:dialog id="createSubjectDlg" widgetVar="createSubjectDlgWV" modal="true" draggable="false" width="1500"
                      height="350">
                <script type="text/javascript">
                    function filterCity(itemLabel, filterValue) {
                        debugger;
                        let strArray = itemLabel.split(" ");
                        return strArray[1].startsWith(filterValue);
                    }
                </script>
                <p:remoteCommand name="updatebirhDateFromDialog" update="birhDateFromDialog" process="@this"/>
                <p:panelGrid columns="2" style="width: 100%;" styleClass="ui-panelgrid-blank form-group" layout="grid" id="personTypePanel">
                    <p:column>
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_PERSON_TYPE}"/><br/>
                        <p:selectOneRadio value="#{bean.subjectWrapper.typeId}"
                                          update="subjectDialogPanel">
                            <f:selectItems value="#{bean.wrapper.persons}"/>
                            <p:ajax update="subjectDialogPanel"/>
                        </p:selectOneRadio>
                    </p:column>
                </p:panelGrid>
                <p:remoteCommand update="subjectDialogPanel" name="updateSubjectCreateDialogPanel"/>
                <p:panelGrid id="subjectDialogPanel" columns="4"
                             style="width: 100%;" styleClass="ui-panelgrid-blank form-group" layout="grid">
                    <p:column rendered="#{bean.subjectWrapper.typeId eq 1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SURNAME}"/><br/>
                        <p:inputText styleClass="input-width" required="true"
                                     value="#{bean.subjectWrapper.surname}" onkeyup="fieldValueToUpperCase(this);">
                            <f:validateLength minimum="2"/>
                        </p:inputText>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                    <p:column rendered="#{bean.subjectWrapper.typeId eq 1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_NAME}"/><br/>
                        <p:inputText value="#{bean.subjectWrapper.name}" styleClass="input-width" required="true"
                                     onkeyup="fieldValueToUpperCase(this);">
                            <f:validateLength minimum="2"/>
                        </p:inputText>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                    <p:column rendered="#{bean.subjectWrapper.typeId eq 1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SEX_TYPE}"/><br/>
                        <p:selectOneRadio value="#{bean.subjectWrapper.selectedSexTypeId}" required="true">
                            <f:selectItems value="#{bean.wrapper.sexTypes}"/>
                        </p:selectOneRadio>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                    <p:column rendered="#{bean.subjectWrapper.typeId eq 1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_BIRTHDAY}"/><br/>
                        <p:calendar id="birhDateFromDialog" value="#{bean.subjectWrapper.birthDate}" required="true"
                                    pattern="dd/MM/yyyy" styleClass="calendar-width" mask="true" navigator="true"
                                    converter="fullDateTimeConverter" maxdate="#{bean.todayDate}"/>
                        <p:message for="@previous" display="icon"/>
                    </p:column>

                    <p:column rendered="#{bean.subjectWrapper.typeId eq 2}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SOCIAL_REGION}"/><br/>
                        <p:inputText value="#{bean.subjectWrapper.businessName}" required="true"
                                     styleClass="input-width" onkeyup="fieldValueToUpperCase(this);"/>
                        <p:message for="@previous" display="icon"/>
                    </p:column>

                    <p:column rendered="#{not empty bean.subjectWrapper.typeId}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_PROVINCE}"/><br/>
                        <p:selectOneMenu value="#{bean.subjectWrapper.provinceId}" required="true"
                                         styleClass="select-width" filter="true">
                            <f:selectItems value="#{bean.wrapper.provinces}"/>
                            <p:ajax event="change" process="@this"
                                    oncomplete="updateSubjectCreateDialogPanel();"
                                    onsuccess="document.getElementById('subjectCreateFiscalCode').value='';"
                                    listener="#{bean.subjectWrapper.onChangeProvince}"/>
                        </p:selectOneMenu>
                        <p:message for="@previous" display="icon"/>
                    </p:column>

                    <p:column
                            rendered="#{not empty bean.subjectWrapper.typeId and bean.subjectWrapper.provinceId!=-1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_COMUNE}"/><br/>
                        <p:selectOneMenu value="#{bean.subjectWrapper.cityId}" required="true"
                                         styleClass="select-width" filter="true" filterFunction="filterCity"
                                         filterMatchMode="custom">
                            <f:selectItems value="#{bean.subjectWrapper.cities}"/>
                        </p:selectOneMenu>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                    <p:column
                            rendered="#{bean.subjectWrapper.typeId==2 and bean.subjectWrapper.provinceId == -1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_JURIDICAL_NATIONS}"/><br/>
                        <p:selectOneMenu styleClass="select-width" required="true"
                                         value="#{bean.subjectWrapper.selectedJuridicalNationId}" filter="true">
                            <f:selectItems value="#{bean.wrapper.juridicalNations}"/>
                        </p:selectOneMenu>
                        <p:message for="@previous" display="icon"/>
                    </p:column>

                    <p:column rendered="#{bean.subjectWrapper.typeId eq 2}"/>

                    <p:column rendered="#{bean.subjectWrapper.typeId eq 2}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_IVA}"/><br/>
                        <p:inputText id="subjectCreateNumberVat" value="#{bean.subjectWrapper.numberVAT}"
                                     required="#{bean.subjectWrapper.typeId==2 and empty bean.subjectWrapper.fiscalCode}"
                                     styleClass="input-width">
                            <p:ajax update="subjectCreateFiscalCode"/>
                        </p:inputText>
                        <p:message for="@previous" display="icon"/>
                        <br/>
                        <p:commandButton action="#{bean.subjectWrapper.restoreFiscalCode}"
                                         update="subjectDialogPanel, messages,restoreRequestSubjectTable" style="margin-top: 3px" process="@this"
                                         value="#{msg.databaseListSubjectFiscalCodeRestore}" immediate="true"/>
                    </p:column>

                    <p:column rendered="#{bean.subjectWrapper.typeId eq 2}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_OLD_IVA}"/><br/>
                        <p:inputText id="subjectCreateOldNumberVat" value="#{bean.subjectWrapper.oldNumberVAT}"
                                     required="#{bean.subjectWrapper.typeId==2 and empty bean.subjectWrapper.fiscalCode}"
                                     styleClass="input-width">
                            <p:ajax update="subjectCreateFiscalCode"/>
                        </p:inputText>
                        <p:message for="@previous" display="icon"/>
                    </p:column>

                    <p:column
                            rendered="#{bean.subjectWrapper.typeId==1 and bean.subjectWrapper.provinceId==-1}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_NATIONS}"/><br/>
                        <p:selectOneMenu value="#{bean.subjectWrapper.selectedNationId}" required="true"
                                         styleClass="select-width" filter="true">
                            <f:selectItems value="#{bean.wrapper.nations}"/>
                        </p:selectOneMenu>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                    <p:column rendered="#{not empty bean.subjectWrapper.typeId}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_FISCAL_CODE}"/><br/>
                        <p:inputText id="subjectCreateFiscalCode" value="#{bean.subjectWrapper.fiscalCode}"
                                     required="#{bean.subjectWrapper.typeId==1 || empty bean.subjectWrapper.numberVAT}"
                                     onkeyup="fieldValueToUpperCase(this);" styleClass="input-width">
                            <p:ajax update="subjectCreateNumberVat"/>
                        </p:inputText>
                        <p:message for="@previous" display="icon"/>
                        <br/>
                        <p:outputPanel rendered="#{bean.subjectWrapper.typeId eq 1}">
                            <p:commandButton action="#{bean.subjectWrapper.generateFiscalCode}"
                                             process="@(#subjectDialogPanel :not(#subjectCreateFiscalCode))"
                                             update="subjectDialogPanel" style="margin-top: 3px"
                                             value="#{msg.databaseListSubjectFiscalCodeGenerate}"/>
                            <p:commandButton action="#{bean.subjectWrapper.restoreFiscalCode}"
                                             update="subjectDialogPanel, messages" style="margin-top: 3px" process="@this"
                                             value="#{msg.databaseListSubjectFiscalCodeRestore}" immediate="true"/>
                        </p:outputPanel>
                    </p:column>

                    <p:column rendered="#{not empty bean.subjectWrapper.typeId}">
                        <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_TIPO_RELAZIONE}"/><br/>
                        <p:selectOneMenu id="sectionCType" style="width: 92%"
                                         value="#{bean.subjectWrapper.sectionCType}"
                                         label="#{enums.documentGenerationTagsSUBJECT_MASTERY_TIPO_RELAZIONE}">
                            <f:selectItem itemValue="" itemLabel="- Non selezionato -" />
                            <f:selectItem itemValue="A favore" itemLabel="A favore" />
                            <f:selectItem itemValue="Contro" itemLabel="Contro" />
                        </p:selectOneMenu>
                        <p:message for="@previous" display="icon"/>
                    </p:column>
                </p:panelGrid>
                <div class="btn_line">
                    <p:commandButton value="#{msg.save}" styleClass="ui-button-success"
                                     action="#{bean.saveSubjectToList}" update="subjectDialogPanel, messages"/>
                    <p:commandButton value="#{msg.cancel}" process="@this"
                                     oncomplete="PF('createSubjectDlgWV').hide();"/>
                </div>
            </p:dialog>

            <p:dialog widgetVar="subjectRestoreDlg" modal="true"
                      draggable="false" position="center center" width="1500">
                <p:scrollPanel mode="native" id="restoreRequestSubjectTableScrollBar" style="width: 100%; min-height: 300px; max-height: 600px;">
                    <p:dataTable value="#{bean.subjectWrapper.subjectsToRestore}"
                                 var="subject"
                                 selection="#{bean.subjectWrapper.selectedSubjectToRestore}"
                                 rowKey="#{subject.id}" id="restoreRequestSubjectTable">
                        <p:column selectionMode="single"
                                  style="width:16px;text-align:center" />
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SOCIAL_REGION}"
                                rendered="#{bean.subjectWrapper.typeId eq 2}">
                            <h:outputText value="#{subject.businessName}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_IVA}"
                                rendered="#{bean.subjectWrapper.typeId eq 2}">
                            <h:outputText value="#{subject.numberVAT}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SURNAME}"
                                rendered="#{bean.subjectWrapper.typeId eq 1}">
                            <h:outputText value="#{subject.surname}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_NAME}"
                                rendered="#{bean.subjectWrapper.typeId eq 1}">
                            <h:outputText value="#{subject.name}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SEX_TYPE}"
                                rendered="#{bean.subjectWrapper.typeId eq 1}">
                            <h:outputText
                                    value="#{subject.sexType ne null ? subject.sexType.toString() : ''}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_BIRTHDAY}"
                                rendered="#{bean.subjectWrapper.typeId eq 1}">
                            <h:outputText value="#{subject.birthDate}"
                                          converter="dateTimeConverter" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_FISCAL_CODE}">
                            <h:outputText value="#{subject.fiscalCode}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_PROVINCE}">
                            <h:outputText value="#{subject.birthProvince}" />
                        </p:column>
                        <p:column
                                headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_COMUNE}">
                            <h:outputText value="#{subject.birthCity}" />
                        </p:column>
                        <f:facet name="footer">
                            <p:commandButton update="subjectDialogPanel" value="#{msg.ok}"
                                             process="restoreRequestSubjectTable"
                                             oncomplete="PF('subjectRestoreDlg').hide()"
                                             action="#{bean.subjectWrapper.selectRestoredSubject}" />
                        </f:facet>
                    </p:dataTable>
                </p:scrollPanel>
            </p:dialog>
            <p:dialog id="documentDialog" widgetVar="documentDialog" modal="true" resizable="false" draggable="false"
                      width="700">
                <p:scrollPanel mode="native"  style="width: 100%; min-height: 300px; max-height: 600px;">
                    <p:dataTable value="#{bean.requestDocuments}" var="doc" id="requestDocs">
                        <p:column headerText="#{msg.name}">
                            <h:outputText value="#{doc.title}#{not empty doc.fileExtension ? doc.fileExtension : '' }"/>
                        </p:column>
                        <p:column styleClass="action_column">
                            <p:commandButton icon="fa fa-download" action="#{bean.downloadRequestFile}" ajax="false">
                                <f:setPropertyActionListener value="#{doc.id}" target="#{bean.entityEditId}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </p:scrollPanel>
            </p:dialog>
        </p:fragment>
    </ui:define>
</ui:composition>
