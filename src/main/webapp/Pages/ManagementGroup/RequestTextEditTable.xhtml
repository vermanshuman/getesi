<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">
    <style>
        .without-header thead {
            display: none;
        }

        .background-lightorange-td .ui-editable-column {
            background: #fed8b1 !important;
            height: 30px;
        }
        .ui-cell-editor .background-lightorange-td {
            background: #fed8b1 !important;
            height: 30px;
        }
        .background-lightblue-td .ui-panelgrid-cell {
            background: #d0d9e6 !important;
            height: 30px;
        }

        body .ui-datatable .ui-datatable-data tr td {
            padding: 6px 12px !important;
        }
        body .ui-datatable thead th {
            padding: 8px 14px !important;
        }

        .red-btn {
            background: red !important;
            background-color: red !important;
            color: #FFFFFF !important;
        }
        .ui-dialog-titlebar-icon {
            color: red !important;
        }
        #commentDialog{
            left: calc(50% - 500px) !important;
            top: calc(50% - 200px) !important;
        }
        .cost_titles > .p-field > span {
            font-size: 14px !important;
            font-weight: bold !important;
        }
    </style>
    <script type="text/javascript">
        function check_numbers_if_should(symbolsAreAllowed, myfield, int, float) {
            if (!symbolsAreAllowed) {
                check_numbers(myfield, int, float);
            } else {
                myfield.value = "non disponibile";
            }
        }

        function numbers_only_if_should(symbolsAreAllowed, myfield, e, int, float) {
            if (!symbolsAreAllowed) {
                return numbers_only(myfield, e, int, float);
            } else {
                return true;
            }
        }
    </script>
    <div style="margin-bottom: 1%;">

        <p:dataTable value="#{bean.requestConservatoryList}" var="item" styleClass="without-header simple-table"
                     rendered="#{empty bean.examRequest.distraintFormality}" emptyMessage="#{msg.noRecordsFound}">
            <p:column>
                <h:outputText
                        value="#{empty item.registry ? msg.subjectViewCadastralDateC: msg.subjectViewCadastralDate}
				 #{item.registry.name}"/>
            </p:column>
            <p:column>
                <p:calendar value="#{item.conservatoryDate}" pattern="dd/MM/yyyy" mask="true" disabledWeekends="true"
                            mindate="#{bean.conservatoryMinDate}" maxdate="#{bean.conservatoryMaxDate}"/>
            </p:column>
        </p:dataTable>
        <br/>
        <div align="center">
            <p:outputPanel rendered="#{not empty bean.examRequest.distraintFormality}">
                <h:outputText value="#{msg.requestTextEditDistraintFormalityPresentationDate}:"/>
                <p:calendar value="#{bean.examRequest.distraintFormality.presentationDate}" style="margin-left: 10px"
                            disabled="true" pattern="dd/MM/yyyy"/>
                <br/>
                <br/>
                <h:outputText value="#{msg.requestTextEditEndDate}:"/>
                <p:calendar value="#{bean.requestEndDate}" style="margin-left: 10px"
                            pattern="dd/MM/yyyy" mask="true"
                            mindate="#{bean.examRequest.distraintFormality.presentationDate}"
                            maxdate="#{bean.requestEndDateMax}"/>
                <br/>
            </p:outputPanel>
        </div>
    </div>
    <p:dataTable value="#{bean.estateSituations}" styleClass="simple-table" var="item" id="tableProcedure"
                 rowIndexVar="index" widgetVar="tableProcedureWV" emptyMessage="#{msg.noRecordsFound}">
        <p:column style="width: 30%; vertical-align: top;" headerText="#{msg.formality}">
            <p:dataTable rendered="#{not empty item.estateFormalityList}" value="#{item.estateFormalityList}" emptyMessage="#{msg.noRecordsFound}"
                         var="weakForm" styleClass="without-header cadastral_table" editable="true" editMode="cell">
                <p:column style="width: 15%; text-align: center">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{weakForm.numRG}/#{weakForm.numRP}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{weakForm.numRG}" style="width: 45%" decimalSeparator=""
                                           thousandSeparator="" decimalPlaces="0"/>
                            /
                            <p:inputNumber value="#{weakForm.numRP}" style="width: 45%" decimalSeparator=""
                                           thousandSeparator="" decimalPlaces="0"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="width: 10%; text-align: center">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{weakForm.estateFormalityType.toString()}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu value="#{weakForm.estateFormalityType}" style="width:50%">
                                <f:selectItems value="#{bean.estateFormalityTypes}"/>
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="width: 30%; padding: 2px; text-align: center">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{weakForm.description}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{weakForm.description}"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="width: 10%;padding: 2px;">
                    <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                     update=":form:commentArea" action="#{bean.prepareComment}">
                        <f:setPropertyActionListener value="SELECTED_ESTATE_FORMALITY" target="#{bean.currentComment}"/>
                        <f:setPropertyActionListener value="#{weakForm.id}" target="#{bean.selectedId}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </p:column>
        <p:column headerText="#{msg.esateSituationRegime}:" style="width: 74px;">
            <p:selectBooleanCheckbox value="#{item.regime}">
                <p:ajax listener="#{item.handleRegimeEdit()}" global="false" update="@this" />
            </p:selectBooleanCheckbox>
        </p:column>
        <p:column style="width: 70%; vertical-align: top;" headerText="#{msg.estateLocation}">
            <p:dataTable rendered="#{not empty item.propertyList}" value="#{item.propertyList}" var="estate"
                         editable="true" editMode="cell" styleClass="without-header cadastral_table" emptyMessage="#{msg.noRecordsFound}">
                <p:column style="text-align: center; width: 15%">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{estate.getCategoryType()}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu value="#{estate.selectedCategoryId}" style="width:82%">
                                <p:ajax listener="#{estate.categoryChange}"/>
                                <f:selectItems value="#{bean.categories}"/>
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="text-align: center; width: 15%">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{estate.address}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{estate.address}">
                                <p:ajax listener="#{estate.handleRowEditEvent()}" global="false" update="@this" />
                            </p:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="text-align: center; width: 40%">
                    <p:dataTable value="#{estate.cadastralData}" var="exam" rendered="#{not empty estate.cadastralData}"
                                 styleClass="without-header cadastral_table" editable="true" editMode="cell" emptyMessage="#{msg.noRecordsFound}">
                        <p:column style="text-align: center">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{exam.sheet}" style="font-size: 1.1em; font-weight:bold;"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputText value="#{exam.sheet}"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column style="text-align: center">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{exam.particle}" style="font-size: 1.1em; font-weight:bold;"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputText value="#{exam.particle}"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column style="text-align: center">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{exam.sub}" style="font-size: 1.1em; font-weight:bold;"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputText value="#{exam.sub}"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-4, ui-grid-col-6">
                        <h:outputText value="#{msg.formalityConsistency}:" style="color: black;"/>
                        <p:inputText value="#{estate.consistency}"/>
                        <h:outputText value="#{msg.requestTextEditCadastralArea}:" style="color: black;"/>
                        <p:inputText value="#{estate.cadastralArea}"/>
                        <h:outputText value="#{msg.requestTextEditRevenue}:" style="color: black;"/>
                        <p:inputText value="#{estate.revenue}"/>
                        <h:outputText value="#{msg.requestTextEditMinimum}:" style="color: black;" rendered="#{estate.calculateOmiValue}"/>
                        <p:inputText value="#{estate.minimumValue}" rendered="#{estate.calculateOmiValue}"/>
                        <h:outputText value="#{msg.requestTextEditMaximum}:" style="color: black;" rendered="#{estate.calculateOmiValue}"/>
                        <p:inputText value="#{estate.maximumValue}" rendered="#{estate.calculateOmiValue}"/>
                        <p:commandButton action="#{estate.reCalculateOMI}" value="#{msg.requestTextEditCalculate}"
                                         update="tableProcedure" style="margin-top: 1%;" oncomplete="updateTemplate();" rendered="#{not estate.calculateOmiValue}"/>
                        <p:commandButton action="#{bean.reCalculateOMI}" value="#{msg.requestTextEditCalculate}"
                                         update="tableProcedure" style="margin-top: 1%;" oncomplete="updateTemplate();" rendered="#{estate.calculateOmiValue}"/>
                    </p:panelGrid>
                </p:column>
                <p:column style="text-align: center; width: 17%">
                    <p:outputPanel styleClass="visible-cell-editor-value">
                        <h:outputText value="#{msg.estateLocationOMI}"/>
                        <p:dataTable value="#{estate.lastOmi}" var="omi" editable="true" emptyMessage="#{msg.noRecordsFound}" editMode="cell" styleClass="background-lightorange-td">
                            <p:ajax event="rowEdit" listener="#{estate.setEdit(true)}"/>
                            <p:column>
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{omi.value}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:outputPanel id="inputPanelOmi">
                                            <p:inputText value="#{omi.value}"
                                                         onkeypress="return numbers_only_if_should(#{omi.inappropriate},this, event, 9, 2);"
                                                         onkeyup="check_numbers_if_should(#{omi.inappropriate},this, 9, 2);">
                                                <p:ajax listener="#{estate.handleRowEditEvent()}" global="false" update="@this" />
                                            </p:inputText>
                                            <h:outputText value="#{msg.estateLocationOMINotInappropriate} "
                                                          style="color: white;"/>
                                            <p:selectBooleanCheckbox value="#{omi.inappropriate}">
                                                <p:ajax event="change" update="inputPanelOmi"
                                                        listener="#{estate.changeOmi(omi)}"/>
                                            </p:selectBooleanCheckbox>
                                        </p:outputPanel>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                        </p:dataTable>
                        <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                            <p:outputPanel style="display:inline-flex;">
                                <h:outputText value="#{estate.calculatedOmi.value}" style="color: #5f666c;"/>
                                <p:outputPanel style="margin-left: 3px;" id="omiSevZones" rendered="#{estate.calculatedOmi.severalZones}">
                                    <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                </p:outputPanel>
                                <p:tooltip for="omiSevZones" value="#{msg.requestTextEditSeveralZones}"/>
                                <p:outputPanel style="margin-left: 3px;" id="omiSevComprs" rendered="#{estate.calculatedOmi.severalComprs}">
                                    <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                </p:outputPanel>
                                <p:tooltip for="omiSevComprs" value="#{msg.requestTextEditSeveralMaxMinComprs}"/>
                                <p:outputPanel style="margin-left: 3px;" id="omiMultiCoord" rendered="#{estate.calculatedOmi.multipleCoordinates}">
                                    <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                </p:outputPanel>
                                <p:tooltip for="omiMultiCoord" value="#{msg.requestTextEditMultipleCoordinates}"/>
                                <p:outputPanel style="margin-left: 3px;" id="categoryCodeInfo" rendered="#{not estate.calculatedOmi.multipleCoordinates and estate.calculatedOmi.categoryCodeMissing}">
                                    <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                </p:outputPanel>
                                <p:tooltip for="categoryCodeInfo" value="#{msg.requestTextEditCategoryCodeMissing}"/>
                            </p:outputPanel>
                        </p:panelGrid>
                    </p:outputPanel>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{msg.estateLocationCommercial}"/>
                            <p:panelGrid columns="1" styleClass="border-omi-value background-lightorange-td">
                                <h:outputText value="#{estate.lastCommercial}"/>
                            </p:panelGrid>
                        </f:facet>
                        <f:facet name="input">
                            <p:outputPanel id="inputPanel">
                                <h:outputText value="#{msg.estateLocationCommercial}"/>
                                <p:inputText value="#{estate.lastCommercial}"
                                             onkeypress="return numbers_only(this, event, 9, 2)"
                                             onkeyup="check_numbers(this, 9, 2);">
                                    <p:ajax listener="#{estate.handleRowEditEvent()}" global="false" update="@this" />
                                </p:inputText>
                            </p:outputPanel>
                        </f:facet>
                    </p:cellEditor>
                    <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                        <h:outputText value="#{estate.calculatedCommercial}" style="color: #5f666c;"/>
                    </p:panelGrid>
                </p:column>
                <p:column style="width: 30px;padding: 2px;">
                    <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                     rendered="#{empty bean.examRequest.distraintFormality}"
                                     update=":form:commentArea" action="#{bean.prepareComment}">
                        <f:setPropertyActionListener value="SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                        <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                    </p:commandButton>
                    <p:rowToggler rendered="#{not empty bean.examRequest.distraintFormality}"/>
                </p:column>
                <p:column style="width: 30px;padding: 2px;">
                    <p:commandButton icon="fa fa-bars" onclick="PF('relationshipDlg').show();"
                                     update=":form:relationshipArea, :form:relationshipTable"
                                     action="#{bean.prepareRelationships}" onerror="console.log(arguments)">
                        <f:setPropertyActionListener value="SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                        <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                    </p:commandButton>
                </p:column>
                <p:rowExpansion>
                    <p:dataTable value="#{estate.associatedWithEstateSituationDatafromProperties}" var="datafrom"
                                 id="datafromTable" emptyMessage="#{msg.noRecordsFound}" rowStyleClass="#{datafrom.associated ? null : 'delete-row'}">
                        <p:column>
                            <h:outputText value="#{datafrom.text}"/>
                        </p:column>
                        <p:column style="width: 34px;padding: 2px;">
                            <p:commandButton icon="fa fa-comment" oncomplete="PF('datafromEditDlg').show();"
                                             update=":form:datafromArea">
                                <f:setPropertyActionListener value="#{bean.estateSituations.indexOf(item)}"
                                                             target="#{bean.estateSituationId}"/>
                                <f:setPropertyActionListener
                                        value="#{estate.associatedWithEstateSituationDatafromProperties.indexOf(datafrom)}"
                                        target="#{bean.entityEditId}"/>
                                <f:setPropertyActionListener value="#{item.propertyList.indexOf(estate)}"
                                                             target="#{bean.selectedId}"/>
                                <f:setPropertyActionListener value="#{datafrom.text}"
                                                             target="#{bean.datafromPropertyText}"/>
                            </p:commandButton>
                        </p:column>
                        <p:column style="width: 34px;padding: 2px;">
                            <p:commandButton icon="fa fa-close" update="datafromTable"
                                             action="#{bean.deleteDatafromPropertyAssociation}" >
                                <f:setPropertyActionListener value="#{bean.estateSituations.indexOf(item)}"
                                                             target="#{bean.estateSituationId}"/>
                                <f:setPropertyActionListener
                                        value="#{estate.associatedWithEstateSituationDatafromProperties.indexOf(datafrom)}"
                                        target="#{bean.entityEditId}"/>
                                <f:setPropertyActionListener value="#{item.propertyList.indexOf(estate)}"
                                                             target="#{bean.selectedId}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton style="margin-top: 10px" icon="fa fa-plus" oncomplete="PF('datafromEditDlg').show();"
                                     update=":form:datafromArea">
                        <f:setPropertyActionListener value="#{bean.estateSituations.indexOf(item)}"
                                                     target="#{bean.estateSituationId}"/>
                        <f:setPropertyActionListener value="#{null}" target="#{bean.entityEditId}"/>
                        <f:setPropertyActionListener value="#{item.propertyList.indexOf(estate)}"
                                                     target="#{bean.selectedId}"/>
                        <f:setPropertyActionListener value="" target="#{bean.datafromPropertyText}"/>
                    </p:commandButton>
                </p:rowExpansion>
            </p:dataTable>
        </p:column>
        <p:column style="width: 34px;padding: 7px 2px 2px;vertical-align: top;">
            <p:commandButton icon="fa fa-commenting" oncomplete="PF('commentEditDlg').show();"
                             update=":form:commentArea" action="#{bean.prepareComment}">
                <f:setPropertyActionListener value="SELECTED_ESTATE_SITUATION_INIT" target="#{bean.currentComment}"/>
                <f:setPropertyActionListener value="#{item.comment.id}" target="#{bean.selectedId}"/>
            </p:commandButton>
            <br/>
            <br/>
            <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                             update=":form:commentArea" action="#{bean.prepareComment}">
                <f:setPropertyActionListener value="SELECTED_ESTATE_SITUATION" target="#{bean.currentComment}"/>
                <f:setPropertyActionListener value="#{item.comment.id}" target="#{bean.selectedId}"/>
            </p:commandButton>
            <br/>
            <br/>
            <p:commandButton icon="fa fa-bars" oncomplete="PF('estateSituationRelationshipDlg').show();"
                             update=":form:estaeRelationshipArea, :form:estateRelationshipTable"
                             action="#{bean.prepareRelationships}">
                <f:setPropertyActionListener value="SELECTED_ESTATE_SITUATION" target="#{bean.currentComment}"/>
                <f:setPropertyActionListener value="#{item.estateSituationId}" target="#{bean.selectedId}"/>
            </p:commandButton>
        </p:column>
    </p:dataTable>
    <br/>
    <p:commandButton icon="fa fa-comment" value="#{msg.requestTextEditCertificateComment}"
                     oncomplete="PF('commentEditDlg').show();"
                     update=":form:commentArea" action="#{bean.prepareComment}" style="margin-left: 20px; float: right;"
                     rendered="#{not empty bean.examRequest.distraintFormality}">
        <f:setPropertyActionListener value="COMMENT_CERTIFICATION" target="#{bean.currentComment}"/>
    </p:commandButton>
    <br/>
    <h3>#{msg.textEditTableGravami}</h3>
    <p:outputPanel deferred="true">
        <p:dataTable value="#{bean.estateSituationFormalities}" styleClass="simple-table" emptyMessage="#{msg.noRecordsFound}" var="item" id="formalityTable">
            <p:column headerText="#{msg.estateFormalityNumRG}">
                <h:outputText value="#{item.generalRegister}"/>
            </p:column>
            <p:column headerText="#{msg.estateFormalityNumRP}">
                <h:outputText value="#{item.particularRegister}"/>
            </p:column>
            <p:column headerText="#{msg.formalityPresentationDate}">
                <h:outputText value="#{item.presentationDate}" converter="dateTimeConverter"/>
            </p:column>
            <p:column style="width: 10%;padding: 7px 2px 2px;vertical-align: top;">
                <p:commandButton value="#{msg.requestOldRequestDetails}"
                                 action="#{bean.renderFormalityDetails}" update=":form:formalityDetailsArea">
                    <f:setPropertyActionListener value="#{item.id}" target="#{bean.selectedFormalityId}"/>
                </p:commandButton>
            </p:column>
            <p:column style="width: 34px;padding: 7px 2px 2px;vertical-align: top;">
                <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                 update=":form:commentArea" action="#{bean.prepareComment}">
                    <f:setPropertyActionListener
                            value="#{bean.examRequest.distraintFormality!=null?'FORMALITY_DISTRAINT_COMMENT':'SELECTED_FORMALITY'}"
                            target="#{bean.currentComment}"/>
                    <f:setPropertyActionListener value="#{item.id}" target="#{bean.selectedId}"/>
                </p:commandButton>
            </p:column>
            <p:column rendered="#{not empty bean.examRequest.distraintFormality}"
                      style="width: 34px;padding: 7px 2px 2px;vertical-align: top;">
                <p:commandButton icon="fa fa-commenting" oncomplete="PF('commentEditDlg').show();"
                                 update=":form:commentArea" action="#{bean.prepareComment}">
                    <f:setPropertyActionListener
                            value="#{'FORMALITY_COMMENT_CERTIFICATION'}"
                            target="#{bean.currentComment}"/>
                    <f:setPropertyActionListener value="#{item.id}" target="#{bean.selectedId}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>
    </p:outputPanel>
    <br/>
    <p:outputPanel id="formalityDetailsArea">
        <p:outputPanel rendered="#{bean.formalityDetailsRendered}">
            <br/>
            <h3>#{msg.textEditTableFormalityDetails}</h3>
            <p:dataTable value="#{bean.gravamiEstateSituations}" var="gitem" id="formalityDetailsTable" emptyMessage="#{msg.noRecordsFound}"
                         rowIndexVar="gindex" widgetVar="formalityDetailsTableWV" editable="true" editMode="cell"
                         styleClass="simple-table without-header cadastral_table">
                <p:column style="width: 20%; vertical-align: top;" headerText="#{msg.formality}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{gitem.formality.generalRegister}/#{gitem.formality.particularRegister}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{gitem.formality.generalRegister}" style="width: 45%" decimalSeparator=""
                                           thousandSeparator="" decimalPlaces="0"/>
                            /
                            <p:inputNumber value="#{gitem.formality.particularRegister}" style="width: 45%" decimalSeparator=""
                                           thousandSeparator="" decimalPlaces="0"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column style="width: 80%; vertical-align: top;" headerText="#{msg.estateLocation}">
                    <p:dataTable rendered="#{not empty gitem.propertyList}" value="#{gitem.propertyList}" var="gestate" emptyMessage="#{msg.noRecordsFound}"
                                 editable="true" editMode="cell" styleClass="without-header cadastral_table">
                        <p:column style="text-align: center">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{gestate.getCategoryType()}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:selectOneMenu value="#{gestate.selectedCategoryId}" style="width:82%">
                                        <p:ajax listener="#{gestate.categoryChange}"/>
                                        <f:selectItems value="#{bean.categories}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column style="text-align: center">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{gestate.address}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputText value="#{gestate.address}">
                                        <p:ajax listener="#{gestate.handleRowEditEvent()}" global="false" update="@this" />
                                    </p:inputText>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column style="text-align: center; width: 35%">
                            <p:dataTable value="#{gestate.cadastralData}" var="gexam" rendered="#{not empty gestate.cadastralData}"
                                         styleClass="without-header cadastral_table" editable="true" editMode="cell" emptyMessage="#{msg.noRecordsFound}">
                                <p:column style="text-align: center">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{gexam.sheet}" style="font-size: 1.1em; font-weight:bold;"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{gexam.sheet}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column style="text-align: center">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{gexam.particle}" style="font-size: 1.1em; font-weight:bold;"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{gexam.particle}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column style="text-align: center">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{gexam.sub}" style="font-size: 1.1em; font-weight:bold;"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{gexam.sub}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                            </p:dataTable>
                            <br/>
                            <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-4, ui-grid-col-6">
                                <h:outputText value="#{msg.formalityConsistency}:" style="color: black;"/>
                                <p:inputText value="#{gestate.consistency}"/>
                                <h:outputText value="#{msg.requestTextEditCadastralArea}:" style="color: black;"/>
                                <p:inputText value="#{gestate.cadastralArea}"/>
                                <h:outputText value="#{msg.requestTextEditRevenue}:" style="color: black;"/>
                                <p:inputText value="#{gestate.revenue}"/>
                                <h:outputText value="#{msg.requestTextEditMinimum}:" style="color: black;" rendered="#{gestate.calculateOmiValue}"/>
                                <p:inputText value="#{gestate.minimumValue}" rendered="#{gestate.calculateOmiValue}"/>
                                <h:outputText value="#{msg.requestTextEditMaximum}:" style="color: black;" rendered="#{gestate.calculateOmiValue}"/>
                                <p:inputText value="#{gestate.maximumValue}" rendered="#{gestate.calculateOmiValue}"/>
                                <p:commandButton action="#{gestate.reCalculateOMI}" value="#{msg.requestTextEditCalculate}"
                                                 update="formalityDetailsTable" style="margin-top: 1%;" rendered="#{not gestate.calculateOmiValue}"/>
                                <p:commandButton action="#{bean.reCalculateOMI}" value="#{msg.requestTextEditCalculate}"
                                                 update="formalityDetailsTable" style="margin-top: 1%;" rendered="#{gestate.calculateOmiValue}"/>
                            </p:panelGrid>

                        </p:column>
                        <p:column style="text-align: center; width: 20%">
                            <p:outputPanel styleClass="visible-cell-editor-value">
                                <h:outputText value="#{msg.estateLocationOMI}"/>
                                <p:dataTable value="#{gestate.lastOmi}" var="gomi" editable="true" editMode="cell" emptyMessage="#{msg.noRecordsFound}">
                                    <p:ajax event="rowEdit" listener="#{gestate.setEdit(true)}"/>
                                    <p:column>
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputText value="#{gomi.value}"/>
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:outputPanel id="inputGPanelOmiNotSelected">
                                                    <p:inputText value="#{gomi.value}"
                                                                 onkeypress="return numbers_only_if_should(#{gomi.inappropriate},this, event, 9, 2);"
                                                                 onkeyup="check_numbers_if_should(#{gomi.inappropriate},this, 9, 2);">
                                                        <p:ajax listener="#{gestate.handleRowEditEvent()}" global="false" update="@this" />
                                                    </p:inputText>
                                                    <h:outputText value="#{msg.estateLocationOMINotInappropriate} "
                                                                  style="color: white;"/>
                                                    <p:selectBooleanCheckbox value="#{gomi.inappropriate}">
                                                        <p:ajax event="change" update="inputGPanelOmiNotSelected"
                                                                listener="#{gestate.changeOmi(gomi)}"/>
                                                    </p:selectBooleanCheckbox>
                                                </p:outputPanel>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                </p:dataTable>
                                <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                                    <p:outputPanel style="display: inline-flex;">
                                        <h:outputText value="#{gestate.calculatedOmi.value}" style="color: #5f666c;"/>
                                        <p:outputPanel style="margin-left: 3px;" id="omiGSevZonesNotSelected" rendered="#{gestate.calculatedOmi.severalZones}">
                                            <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                        </p:outputPanel>
                                        <p:tooltip for="omiGSevComprsNotSelected" value="#{msg.requestTextEditSeveralZones}"/>
                                        <p:outputPanel style="margin-left: 3px;" id="omiGSevComprsNotSelected" rendered="#{gestate.calculatedOmi.severalComprs}">
                                            <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                        </p:outputPanel>
                                        <p:tooltip for="omiGMultiCoordNotSelected" value="#{msg.requestTextEditSeveralMaxMinComprs}"/>
                                        <p:outputPanel style="margin-left: 3px;" id="omiGMultiCoordNotSelected" rendered="#{gestate.calculatedOmi.multipleCoordinates}">
                                            <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                        </p:outputPanel>
                                        <p:tooltip for="gCategoryCodeInfoNotSelected" value="#{msg.requestTextEditMultipleCoordinates}"/>
                                        <p:outputPanel style="margin-left: 3px;" id="gCategoryCodeInfoNotSelected"
                                                       rendered="#{not gestate.calculatedOmi.multipleCoordinates and gestate.calculatedOmi.categoryCodeMissing}">
                                            <img alt="?" src="../../resources/images/attention.png"
                                                 style="width: 19px;" />
                                        </p:outputPanel>
                                        <p:tooltip for="gCategoryCodeInfoNotSelected"
                                                   value="#{msg.requestTextEditCategoryCodeMissing}" />
                                    </p:outputPanel>
                                </p:panelGrid>
                            </p:outputPanel>
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{msg.estateLocationCommercial}"/>
                                    <p:panelGrid columns="1" styleClass="border-omi-value background-lightorange-td">
                                        <h:outputText value="#{gestate.lastCommercial}"/>
                                    </p:panelGrid>
                                </f:facet>
                                <f:facet name="input">
                                    <h:outputText value="#{msg.estateLocationCommercial}"/>
                                    <p:inputText value="#{gestate.lastCommercial}"
                                                 onkeypress="return numbers_only(this, event, 10, 10)"
                                                 onkeyup="check_numbers(this, 10, 10);">
                                        <p:ajax listener="#{gestate.handleRowEditEvent()}" global="false" update="@this" />
                                    </p:inputText>
                                </f:facet>
                            </p:cellEditor>
                            <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                                <h:outputText value="#{gestate.calculatedCommercial}" style="color: #5f666c;"/>
                            </p:panelGrid>
                        </p:column>
                    </p:dataTable>
                </p:column>

            </p:dataTable>
        </p:outputPanel>
    </p:outputPanel>
    <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group"
                 id="requestActsInUpda1ting" rendered="#{bean.costManipulationHelper.costOutput and bean.examRequest.numberActUpdate ne null}">
        <p:column>
            <h3>
                <h:outputText value="#{msg.requestActsInUpdating}" style="margin-right: 150px"/>
            </h3>
        </p:column>
        <p:column>
            <h3>
                <h:outputText value="#{msg.requestCostOutput}" escape="false"/>
            </h3>
        </p:column>

        <p:column>
            <p:inputText value="#{bean.requestNumberActUpdate}"  style="margin-right: 150px"/>
        </p:column>
        <p:column>
            <p:inputText value="#{bean.requestCostForced}" readonly="true"/>
        </p:column>
    </p:panelGrid>
    <br/>
    <br/>
    <ui:fragment rendered="#{bean.showSalesSection}"><h3>#{msg.requestActsDevelopment}</h3></ui:fragment>
    <p:outputPanel deferred="true" deferredMode="visible">
        <p:dataTable value="#{bean.salesOtherEstateSituations}" styleClass="simple-table" var="salesitem" id="salesTableNotSelected"
                     rowIndexVar="sindex" widgetVar="salesTableProcedureNotSelectedWV" emptyMessage="#{msg.noRecordsFound}">
            <p:column style="width: 20%; vertical-align: top;" headerText="#{msg.formality}">
                <p:cellEditor>
                    <f:facet name="output">
                        <h:outputText value="#{salesitem.formality.generalRegister}/#{salesitem.formality.particularRegister}"/>
                    </f:facet>
                    <f:facet name="input">
                        <p:inputNumber value="#{salesitem.formality.generalRegister}" style="width: 45%" decimalSeparator=""
                                       thousandSeparator="" decimalPlaces="0"/>
                        /
                        <p:inputNumber value="#{salesitem.formality.particularRegister}" style="width: 45%" decimalSeparator=""
                                       thousandSeparator="" decimalPlaces="0"/>
                    </f:facet>
                </p:cellEditor>
            </p:column>
            <p:column style="width: 80%; vertical-align: top;" headerText="#{msg.estateLocation}">
                <p:dataTable rendered="#{not empty salesitem.propertyList}" value="#{salesitem.propertyList}" var="salesestate"
                             editable="true" editMode="cell" styleClass="without-header cadastral_table" emptyMessage="#{msg.noRecordsFound}">
                    <p:column style="text-align: center; width:17%;">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{salesestate.getCategoryType()}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{salesestate.selectedCategoryId}" style="width:82%">
                                    <p:ajax listener="#{salesestate.categoryChange}"/>
                                    <f:selectItems value="#{bean.categories}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align: center; width:17%;">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{salesestate.address}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{salesestate.address}">
                                    <p:ajax listener="#{salesestate.handleRowEditEvent()}" global="false" update="@this" />
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align: center; width: 35%">
                        <p:dataTable value="#{salesestate.cadastralData}" var="salesexam" rendered="#{not empty salesestate.cadastralData}"
                                     styleClass="without-header cadastral_table" editable="true" editMode="cell" emptyMessage="#{msg.noRecordsFound}">
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{salesexam.sheet}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{salesexam.sheet}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{salesexam.particle}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{salesexam.particle}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{salesexam.sub}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{salesexam.sub}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                        </p:dataTable>
                        <br/>
                        <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-4, ui-grid-col-6">
                            <h:outputText value="#{msg.formalityConsistency}:" style="color: black;"/>
                            <p:inputText value="#{salesestate.consistency}"/>
                            <h:outputText value="#{msg.requestTextEditCadastralArea}:" style="color: black;"/>
                            <p:inputText value="#{salesestate.cadastralArea}"/>
                            <h:outputText value="#{msg.requestTextEditRevenue}:" style="color: black;"/>
                            <p:inputText value="#{salesestate.revenue}"/>
                            <h:outputText value="#{msg.requestTextEditMinimum}:" style="color: black;" rendered="#{gestate.calculateOmiValue}"/>
                            <p:inputText value="#{salesestate.minimumValue}" rendered="#{gestate.calculateOmiValue}"/>
                            <h:outputText value="#{msg.requestTextEditMaximum}:" style="color: black;" rendered="#{gestate.calculateOmiValue}"/>
                            <p:inputText value="#{salesestate.maximumValue}" rendered="#{gestate.calculateOmiValue}"/>
                            <p:commandButton action="#{salesestate.reCalculateOMI}" value="#{msg.requestTextEditCalculate}"
                                             update="salesTableNotSelected" style="margin-top: 1%;" oncomplete="updateTemplate();"/>
                        </p:panelGrid>

                    </p:column>
                    <p:column style="text-align: center; width: 20%">
                        <p:outputPanel styleClass="visible-cell-editor-value">
                            <h:outputText value="#{msg.estateLocationOMI}"/>
                            <p:dataTable value="#{salesestate.lastOmi}" var="salesomi" editable="true" emptyMessage="#{msg.noRecordsFound}" editMode="cell">
                                <p:ajax event="rowEdit" listener="#{salesestate.setEdit(true)}"/>
                                <p:column>
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{salesomi.value}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:outputPanel id="inputSalesPanelOmiNotSelected">
                                                <p:inputText value="#{salesomi.value}"
                                                             onkeypress="return numbers_only_if_should(#{salesomi.inappropriate},this, event, 9, 2);"
                                                             onkeyup="check_numbers_if_should(#{salesomi.inappropriate},this, 9, 2);">
                                                    <p:ajax listener="#{salesestate.handleRowEditEvent()}" global="false" update="@this" />
                                                </p:inputText>
                                                <h:outputText value="#{msg.estateLocationOMINotInappropriate} "
                                                              style="color: white;"/>
                                                <p:selectBooleanCheckbox value="#{salesomi.inappropriate}">
                                                    <p:ajax event="change" update="inputSalesPanelOmiNotSelected"
                                                            listener="#{salesestate.changeOmi(salesomi)}"/>
                                                </p:selectBooleanCheckbox>
                                            </p:outputPanel>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                            </p:dataTable>
                            <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                                <p:outputPanel style="display: inline-flex;">
                                    <h:outputText value="#{salesestate.calculatedOmi.value}" style="color: #5f666c;"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiSalesSevZonesNotSelected" rendered="#{salesestate.calculatedOmi.severalZones}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiSalesSevZonesNotSelected" value="#{msg.requestTextEditSeveralZones}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiSalesSevComprsNotSelected" rendered="#{salesestate.calculatedOmi.severalComprs}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiSalesSevComprsNotSelected" value="#{msg.requestTextEditSeveralMaxMinComprs}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiSalesMultiCoordNotSelected" rendered="#{salesestate.calculatedOmi.multipleCoordinates}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiSalesMultiCoordNotSelected" value="#{msg.requestTextEditMultipleCoordinates}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="salesCategoryCodeInfoNotSelected"
                                                   rendered="#{not salesestate.calculatedOmi.multipleCoordinates and salesestate.calculatedOmi.categoryCodeMissing}">
                                        <img alt="?" src="../../resources/images/attention.png"
                                             style="width: 19px;" />
                                    </p:outputPanel>
                                    <p:tooltip for="salesCategoryCodeInfoNotSelected"
                                               value="#{msg.requestTextEditCategoryCodeMissing}" />
                                </p:outputPanel>
                            </p:panelGrid>
                        </p:outputPanel>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{msg.estateLocationCommercial}"/>
                                <p:panelGrid columns="1" styleClass="border-omi-value background-lightorange-td">
                                    <h:outputText value="#{salesestate.lastCommercial}"/>
                                </p:panelGrid>
                            </f:facet>
                            <f:facet name="input">
                                <h:outputText value="#{msg.estateLocationCommercial}"/>
                                <p:inputText value="#{salesestate.lastCommercial}"
                                             onkeypress="return numbers_only(this, event, 10, 10)"
                                             onkeyup="check_numbers(this, 10, 10);">
                                    <p:ajax listener="#{salesestate.handleRowEditEvent()}" global="false" update="@this" />
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                        <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                            <h:outputText value="#{salesestate.calculatedCommercial}" style="color: #5f666c;"/>
                        </p:panelGrid>
                    </p:column>
                    <p:column style="width: 34px;padding: 2px;">
                        <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                         update=":form:commentArea" action="#{bean.prepareComment}">
                            <f:setPropertyActionListener value="NOT_SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                            <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                        </p:commandButton>
                    </p:column>
                    <p:column style="width: 34px;padding: 2px;">
                        <p:commandButton icon="fa fa-bars" onclick="PF('relationshipDlg').show();"
                                         update=":form:relationshipArea, :form:relationshipTable"
                                         action="#{bean.prepareRelationships}">
                            <f:setPropertyActionListener value="NOT_SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                            <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:column>
        </p:dataTable>
    </p:outputPanel>
    <br/>
    <br/>
    <p:outputPanel deferred="true" deferredMode="visible">
        <p:dataTable value="#{bean.otherEstateSituations}" styleClass="simple-table" var="item" id="tableNotSelected"
                     rowIndexVar="index" widgetVar="tableProcedureNotSelectedWV" emptyMessage="#{msg.noRecordsFound}">
            <p:column style="width: 50%; vertical-align: top;" headerText="#{msg.estateFormalityNotSelect}">
                <p:dataTable rendered="#{not empty item.estateFormalityList}" value="#{item.estateFormalityList}"
                             var="weakForm" styleClass="without-header cadastral_table" emptyMessage="#{msg.noRecordsFound}" editable="true" editMode="cell">
                    <p:column style="text-align: center">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{weakForm.numRG}/#{weakForm.numRP}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputNumber value="#{weakForm.numRG}" style="width: 45%" decimalSeparator=""
                                               thousandSeparator="" decimalPlaces="0"/>
                                /
                                <p:inputNumber value="#{weakForm.numRP}" style="width: 45%" decimalSeparator=""
                                               thousandSeparator="" decimalPlaces="0"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="width: 20%; text-align: center">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{weakForm.estateFormalityType.toString()}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{weakForm.estateFormalityType}" style="width:50%">
                                    <f:selectItems value="#{bean.estateFormalityTypes}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="padding: 2px; text-align: center">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{weakForm.description}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{weakForm.description}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="width: 10%;padding: 2px;">
                        <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                         update=":form:commentArea" action="#{bean.prepareComment}">
                            <f:setPropertyActionListener value="NOT_SELECTED_ESTATE_FORMALITY"
                                                         target="#{bean.currentComment}"/>
                            <f:setPropertyActionListener value="#{weakForm.id}" target="#{bean.selectedId}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:column>
            <p:column style="width: 60%; vertical-align: top;" headerText="#{msg.estateNotSelect}">
                <p:dataTable rendered="#{not empty item.propertyList}" value="#{item.propertyList}" var="estate"
                             editable="true" editMode="cell" emptyMessage="#{msg.noRecordsFound}" styleClass="without-header cadastral_table">
                    <p:column style="text-align: center">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{estate.getCategoryType()}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{estate.selectedCategoryId}" style="width:82%">
                                    <p:ajax listener="#{estate.categoryChange}"/>
                                    <f:selectItems value="#{bean.categories}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align: center;">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{estate.address}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{estate.address}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align: center; width: 25%">
                        <p:dataTable value="#{estate.cadastralData}" var="exam" rendered="#{not empty estate.cadastralData}"
                                     styleClass="without-header cadastral_table" emptyMessage="#{msg.noRecordsFound}" editable="true" editMode="cell">
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{exam.sheet}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{exam.sheet}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{exam.particle}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{exam.particle}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column style="text-align: center">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{exam.sub}" style="font-size: 1.1em; font-weight:bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{exam.sub}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                    <p:column style="text-align: center; width: 20%">
                        <p:outputPanel styleClass="visible-cell-editor-value">
                            <h:outputText value="#{msg.estateLocationOMI}"/>
                            <p:dataTable value="#{estate.lastOmi}" var="omi" editable="true" emptyMessage="#{msg.noRecordsFound}" editMode="cell">
                                <p:ajax event="rowEdit" listener="#{estate.setEdit(true)}"/>
                                <p:column>
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{omi.value}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:outputPanel id="inputPanelOmiNotSelected">
                                                <p:inputText value="#{omi.value}"
                                                             onkeypress="return numbers_only_if_should(#{omi.inappropriate},this, event, 9, 2);"
                                                             onkeyup="check_numbers_if_should(#{omi.inappropriate},this, 9, 2);">
                                                    <p:ajax listener="#{estate.handleRowEditEvent()}" global="false" update="@this" />
                                                </p:inputText>
                                                <h:outputText value="#{msg.estateLocationOMINotInappropriate} "
                                                              style="color: white;"/>
                                                <p:selectBooleanCheckbox value="#{omi.inappropriate}">
                                                    <p:ajax event="change" update="inputPanelOmiNotSelected"
                                                            listener="#{estate.changeOmi(omi)}"/>
                                                </p:selectBooleanCheckbox>
                                            </p:outputPanel>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                            </p:dataTable>
                            <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                                <p:outputPanel style="display: inline-flex;">
                                    <h:outputText value="#{estate.calculatedOmi.value}" style="color: #5f666c;"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiSevZonesNotSelected" rendered="#{estate.calculatedOmi.severalZones}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiSevZonesNotSelected" value="#{msg.requestTextEditSeveralZones}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiSevComprsNotSelected" rendered="#{estate.calculatedOmi.severalComprs}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiSevComprsNotSelected" value="#{msg.requestTextEditSeveralMaxMinComprs}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="omiMultiCoordNotSelected" rendered="#{estate.calculatedOmi.multipleCoordinates}">
                                        <img alt="?" src="../../resources/images/attention.png" style="width: 19px;"/>
                                    </p:outputPanel>
                                    <p:tooltip for="omiMultiCoordNotSelected" value="#{msg.requestTextEditMultipleCoordinates}"/>
                                    <p:outputPanel style="margin-left: 3px;" id="categoryCodeInfoNotSelected"
                                                   rendered="#{not estate.calculatedOmi.multipleCoordinates and estate.calculatedOmi.categoryCodeMissing}">
                                        <img alt="?" src="../../resources/images/attention.png"
                                             style="width: 19px;" />
                                    </p:outputPanel>
                                    <p:tooltip for="categoryCodeInfoNotSelected"
                                               value="#{msg.requestTextEditCategoryCodeMissing}" />
                                </p:outputPanel>
                            </p:panelGrid>
                        </p:outputPanel>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{msg.estateLocationCommercial}"/>
                                <p:panelGrid columns="1" styleClass="border-omi-value background-lightorange-td">
                                    <h:outputText value="#{estate.lastCommercial}"/>
                                </p:panelGrid>
                            </f:facet>
                            <f:facet name="input">
                                <h:outputText value="#{msg.estateLocationCommercial}"/>
                                <p:inputText value="#{estate.lastCommercial}"
                                             onkeypress="return numbers_only(this, event, 10, 10)"
                                             onkeyup="check_numbers(this, 10, 10);">
                                    <p:ajax listener="#{estate.handleRowEditEvent()}" global="false" update="@this" />
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                        <p:panelGrid columns="1" styleClass="border-omi-value background-lightblue-td">
                            <h:outputText value="#{estate.calculatedCommercial}" style="color: #5f666c;"/>
                        </p:panelGrid>
                    </p:column>
                    <p:column style="width: 9%;padding: 2px;">
                        <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                                         update=":form:commentArea" action="#{bean.prepareComment}">
                            <f:setPropertyActionListener value="NOT_SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                            <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                        </p:commandButton>
                    </p:column>
                    <p:column style="width: 9%;padding: 2px;">
                        <p:commandButton icon="fa fa-bars" onclick="PF('relationshipDlg').show();"
                                         update=":form:relationshipArea, :form:relationshipTable"
                                         action="#{bean.prepareRelationships}">
                            <f:setPropertyActionListener value="NOT_SELECTED_PROPERTY" target="#{bean.currentComment}"/>
                            <f:setPropertyActionListener value="#{estate.id}" target="#{bean.selectedId}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:column>
            <p:column style="width: 34px;padding: 7px 2px 2px;vertical-align: top;">

            </p:column>
        </p:dataTable>
    </p:outputPanel>
    <div align="center">
        <p:commandButton icon="fa fa-comment" oncomplete="PF('commentEditDlg').show();"
                         update=":form:commentArea" action="#{bean.prepareComment}" style="margin-top: 1%;">
            <f:setPropertyActionListener value="REQUEST" target="#{bean.currentComment}"/>
        </p:commandButton>
        <p:dataTable value="#{bean.examRequest.commentsWithInitialize}" var="item" emptyMessage="#{msg.noRecordsFound}" id="commentTable" styleClass="simple-table">
            <p:column headerText="#{msg.requestTextEditComments}">
                <h:outputText value="#{item.comment}" escape="false"/>
            </p:column>
            <p:column styleClass="action_column min_padding_margin" exportable="false">
                <p:commandButton icon="pi pi-pencil" update=":form:commentArea"
                                 oncomplete="PF('commentEditDlg').show();" action="#{bean.editComment(item)}">
                    <f:setPropertyActionListener value="REQUEST" target="#{bean.currentComment}"/>
                </p:commandButton>
            </p:column>
            <p:column styleClass="action_column">
                <p:commandButton update="commentTable" icon="pi pi-times" styleClass="red-btn" action="#{bean.deleteComment(item)}"/>
            </p:column>
        </p:dataTable>

        <p:commandButton action="#{bean.saveChanges}" value="#{msg.situationTableSave}"
                         oncomplete="updateTemplate();$('html,body').scrollTop(0);"
                         style="margin-top: 1%;"/>
    </div>
    <p:remoteCommand name="updateTemplate" action="#{bean.updateTemplate}" oncomplete="$('html,body').scrollTop(0);" update=":edit_text_section, :messages"/>

    <p:dialog header="Commento" widgetVar="commentEditDlg" resizable="false" modal="true" draggable="false"
              closable="false" closeOnEscape="false" id="commentDialog">
        <div id="commentAreaPanel">
            <pe:ckEditor id="commentArea" value="#{bean.comment.comment}"
                         styleClass="for_editor" width="805"
                         contentsCss="#{facesContext.externalContext.requestContextPath}/resources/javascript/CKEditorStyles.css"
                         customConfig="#{facesContext.externalContext.requestContextPath}/resources/javascript/configCKEditor.js"
                         widgetVar="ckEditorWV">
                <p:ajax event="initialize" onstart="onInitCkEditor('commentArea')"
                        oncomplete="addItemToCKeditor('commentArea'), initHeightElement('commentArea')"/>
                <p:ajax event="wysiwygMode"
                        oncomplete="pushListener(CKEDITOR.instances['commentArea'], 'commentArea');"/>
            </pe:ckEditor>
        </div>
        <br/>
        <div align="center">
            <p:commandButton value="#{msg.yes}" action="#{bean.changeComment}" update=":form:estateTab"
                             oncomplete="PF('commentEditDlg').hide()" styleClass="ui-button-success" style="margin-right: 3px;"/>
            <p:commandButton value="#{msg.no}" onclick="PF('commentEditDlg').hide()" styleClass="ui-button-danger"/>
        </div>
    </p:dialog>

    <p:dialog header="Datafrom" widgetVar="datafromEditDlg" resizable="false" modal="true" draggable="false"
              closable="false" closeOnEscape="false" id="datafromDialog">
        <div id="datafromAreaPanel">
            <pe:ckEditor id="datafromArea" value="#{bean.datafromPropertyText}"
                         styleClass="for_editor" width="805"
                         contentsCss="#{facesContext.externalContext.requestContextPath}/resources/javascript/CKEditorStyles.css"
                         customConfig="#{facesContext.externalContext.requestContextPath}/resources/javascript/configCKEditor.js"
                         widgetVar="ckEditorWV">
                <p:ajax event="initialize" onstart="onInitCkEditor('datafromArea')"
                        oncomplete="addItemToCKeditor('datafromArea'), initHeightElement('datafromArea')"/>
                <p:ajax event="wysiwygMode"
                        oncomplete="pushListener(CKEDITOR.instances['datafromArea'], 'datafromArea');"/>
            </pe:ckEditor>
        </div>
        <br/>
        <div align="center">
            <p:commandButton value="#{msg.yes}" action="#{bean.editOrCreateDatafromProperty}" update=":form:estateTab"
                             oncomplete="PF('datafromEditDlg').hide()"/>
            <p:commandButton value="#{msg.no}" onclick="PF('datafromEditDlg').hide()"/>
        </div>
    </p:dialog>

    <p:dialog widgetVar="cadastralDateError" modal="true" draggable="false" position="center center">
        <div class="ui-messages-error ui-corner-all">
            <span class="ui-messages-error-summary">#{val.validationFailed}</span><br/>
            <span class="ui-messages-error-detail">#{val.dateErrorRequestCreateDate}</span>
        </div>
    </p:dialog>

    <p:dialog widgetVar="requestEndDateErrorWV" modal="true" draggable="false" position="center center">
        <div class="ui-messages-error ui-corner-all">
            <span class="ui-messages-error-summary">#{val.validationFailed}</span><br/>
            <span class="ui-messages-error-detail">#{val.dateErrorRequestEndDate}</span>
        </div>
    </p:dialog>

    <p:dialog widgetVar="relationshipDlg" resizable="false" modal="true" draggable="false" closable="true"
              id="relationshipDlg" width="600">
        <p:dataTable value="#{bean.currentProperty.relationshipListToShow}" var="item" id="relationshipTable"
                     styleClass="simple-table" emptyMessage="#{msg.noRecordsFound}">
            <p:column headerText="#{msg.databaseListRealEstateQuote}">
                <h:outputText value="#{item.quote1} / #{item.quote2}"/>
            </p:column>
            <p:column headerText="#{msg.databaseListRealEstatePropertyType}">
                <h:outputText value="#{item.type.description}"/>
            </p:column>
            <p:column headerText="#{msg.databaseListRealEstateSubject}">
                <h:outputText value="#{item.subject.fullName}"/>
            </p:column>
            <p:column styleClass="action_column">
                <p:commandButton update="relationshipArea" icon="fa fa-edit" action="#{bean.editRelationShip}">
                    <f:setPropertyActionListener value="#{item}" target="#{bean.editRelationship}"/>
                </p:commandButton>
            </p:column>
            <p:column styleClass="action_column">
                <p:commandButton update="relationshipTable" icon="fa fa-remove" action="#{bean.deleteRelationship}">
                    <f:setPropertyActionListener value="#{item}" target="#{bean.deleteRelationship}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>
        <p:panelGrid columns="3" styleClass="ui-panelgrid-blank form-group" id="relationshipArea">
            <span> #{msg.databaseListRealEstateQuote}:</span>
            <p:column>
                <p:inputText id="inputQuote1" value="#{bean.quote1}" onkeypress="numbers_only('#inputQuote1');"/>
                <h:outputText value=" / "/>
                <p:inputText id="inputQuote2" value="#{bean.quote2}" onkeypress="numbers_only('#inputQuote2');"/>
            </p:column>
            <p:column/>
            <span> #{msg.databaseListRealEstatePropertyType}:</span>
            <p:column>
                <p:selectOneMenu value="#{bean.propertyType}" id="propertyType">
                    <f:selectItems value="#{bean.propertyTypeList}"/>
                </p:selectOneMenu>
            </p:column>
            <p:commandButton icon="fa fa-plus" action="#{bean.saveRelationship}"
                             update="relationshipArea, relationshipTable"/>
        </p:panelGrid>
    </p:dialog>
    <p:dialog widgetVar="estateSituationRelationshipDlg" resizable="false" modal="true" draggable="false" closable="true"
              id="estateSituationRelationshipDlg" width="600">
        <p:dataTable value="#{bean.estateSituationRelationshipList}" var="item" id="estateRelationshipTable"
                     styleClass="simple-table" emptyMessage="#{msg.noRecordsFound}">
            <p:column headerText="#{msg.databaseListRealEstateQuote}">
                <h:outputText value="#{item.quote1} / #{item.quote2}"/>
            </p:column>
            <p:column headerText="#{msg.databaseListRealEstatePropertyType}">
                <h:outputText value="#{item.type.description}"/>
            </p:column>
            <p:column headerText="#{msg.databaseListRealEstateSubject}">
                <h:outputText value="#{item.subject.fullName}"/>
            </p:column>
            <p:column styleClass="action_column">
                <p:commandButton update="estaeRelationshipArea" icon="fa fa-edit" action="#{bean.editAllRelationShip}">
                    <f:setPropertyActionListener value="#{item}" target="#{bean.editRelationship}"/>
                </p:commandButton>
            </p:column>
            <p:column styleClass="action_column">
                <p:commandButton update="estateRelationshipTable" icon="fa fa-remove" action="#{bean.deleteAllRelationship}">
                    <f:setPropertyActionListener value="#{item}" target="#{bean.deleteRelationship}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>
        <p:panelGrid columns="3" styleClass="ui-panelgrid-blank form-group" id="estaeRelationshipArea">
            <span> #{msg.databaseListRealEstateQuote}:</span>
            <p:column>
                <p:inputText id="estateInputQuote1" value="#{bean.estateQuote1}" onkeypress="numbers_only('#estateInputQuote1');"/>
                <h:outputText value=" / "/>
                <p:inputText id="estateInputQuote2" value="#{bean.estateQuote2}" onkeypress="numbers_only('#estateInputQuote2');"/>
            </p:column>
            <p:column/>
            <span> #{msg.databaseListRealEstatePropertyType}:</span>
            <p:column>
                <p:selectOneMenu value="#{bean.estatePropertyType}" id="estatePropertyType">
                    <f:selectItems value="#{bean.propertyTypeList}"/>
                </p:selectOneMenu>
            </p:column>
            <p:column/>
            <span> #{msg.databaseListRegime}:</span>
            <p:column>
                <p:selectOneMenu value="#{bean.estateSelectedRegime}" id="estateRegimeType">
                    <f:selectItems value="#{bean.regimes}"/>
                </p:selectOneMenu>
            </p:column>
            <p:commandButton icon="fa fa-plus" action="#{bean.saveAllRelationship}"
                             update="estaeRelationshipArea, estateRelationshipTable"/>
        </p:panelGrid>
    </p:dialog>

</ui:composition>