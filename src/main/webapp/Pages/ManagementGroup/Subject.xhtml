<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ff="http://readytech.com/functions"
                template="/resources/tpl/Admin/EditBase.xhtml">
    <ui:param name="bean" value="#{subjectBean}"/>
    <ui:param name="edit_title"
              value="#{bean.entity.isNew ? msg.databaseListSubjectNew : msg.databaseListSubjectEdit}"/>
    <ui:param name="renderSideMenu" value="#{bean.renderHeader}"/>
    <ui:param name="centerPartStyleClass" value="false"/>
    <ui:param name="showSave" value="#{!bean.onlyView and bean.showSave}"/>
    <ui:param name="showCancel" value="#{bean.showCancel}"/>
    <ui:param name="notShowMenu" value="#{!bean.renderHeader}"/>
    <ui:param name="renderHeaderMenu" value="#{bean.renderHeader}"/>
    <ui:param name="renderFooterMenu" value="#{bean.renderFooter}"/>
    <ui:param name="customCancelMsg"
              value="#{bean.onlyView ? msg.close : msg.cancel}"/>

    <ui:define name="edit_body">
        <script type="application/javascript">
            // <![CDATA[
            window.onload = function() {
                document.getElementById('hidden:link').onclick();
                var frameElement = document.getElementsByTagName("iframe");
                if(frameElement.length > 0) {
                    var doc = frameElement[0];
                    doc.parentElement.insertAdjacentHTML("afterend", "<style>span.menu {display: none;} .layout-main {padding-top: 0 !important;margin-left: 0 !important;}</style>");
                }
            }
            // ]]>
        </script>
        <style type="text/css">
            .ui-button.green-button {
                background-color: #00cc52 !important;
                width: 150px;
                margin-right: 5px;
            }
            .ui-button.red-button {
                background-color: #F3362B !important;
                width: 150px;
            }
        </style>
        <h:form id="hidden" style="display:none">
            <h:commandLink id="link">
                <f:ajax event="click" listener="#{bean.loadTabs}" />
            </h:commandLink>
        </h:form>

		<f:facet name="actions">
        	<h:commandLink styleClass="ui-panel-titlebar-icon
               ui-corner-all ui-state-default" style="color: #ffffff;width: auto;position: relative;top: 2px;background-color: transparent;"
               action="#{bean.downloadPdfFile}" ajax="false">
            	<h:outputText value="#{msg.subjectDossier}" />
			</h:commandLink>
		</f:facet>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group">

			<span><span class="red">*</span>
                #{msg.databaseListSubjectType}:</span>
            <p:selectOneRadio value="#{bean.entity.typeId}" id="subjectType"
                              disabled="#{bean.onlyView}" onchange="updateForm();">
                <f:selectItems value="#{bean.subjectTypes}"/>
            </p:selectOneRadio>
        </p:panelGrid>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                     columnClasses="ui-grid-col-2, ui-grid-col-3" rendered="#{bean.isPhysicalPerson}">

            <span><span class="red">*</span> #{msg.lastname}:</span>
            <p:inputText id="lastName" maxlength="50" styleClass="input-width"
                         onkeyup="fieldValueToUpperCase(this);"
                         value="#{bean.entity.surname}" label="#{msg.lastname}"
                         onkeypress="numbers_letters_only('#lastName');"
                         rendered="#{!bean.onlyView}"/>
            <h:outputText value="#{ff:upper(bean.entity.surname)}"
                          rendered="#{bean.onlyView}" style="font-weight: bold;"/>

            <span><span class="red">*</span> #{msg.name}:</span>
            <p:inputText id="name" maxlength="50" value="#{bean.entity.name}" styleClass="input-width"
                         label="#{msg.name}" onkeypress="numbers_letters_only('#name');"
                         rendered="#{!bean.onlyView}" onkeyup="fieldValueToUpperCase(this);"/>
            <h:outputText value="#{ff:upper(bean.entity.name)}" style="font-weight: bold;"
                          rendered="#{bean.onlyView}"/>

            <span><span class="red">*</span>
                #{msg.databaseListSubjectBirthDate}:</span>
            <p:calendar id="birthdate" readonlyInput="#{bean.onlyView}"
                        styleClass="calendar-width" pattern="dd/MM/yyyy" mask="true"
                        locale="it" navigator="true" popupIconOnly="true"
                        value="#{bean.entity.birthDate}" yearRange="c-70:c+10"
                        disabled="#{bean.onlyView}"/>
        </p:panelGrid>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                     columnClasses="ui-grid-col-2, ui-grid-col-3" rendered="#{not bean.isPhysicalPerson}">
			<span><span class="red">*</span>
                #{msg.databaseListSubjectBusinessName}:</span>
            <p:inputText value="#{bean.entity.businessName}" id="businessName" styleClass="input-width"
                         maxlength="150" rendered="#{!bean.onlyView}"/>
            <h:outputText value="#{ff:upper(bean.entity.businessName)}" style="font-weight: bold;"
                          rendered="#{bean.onlyView}"/>

            <span><span class="red">*</span>
                #{msg.databaseListSubjectVATNumber}:</span>
            <p:inputText value="#{bean.entity.numberVAT}" id="numberVAT" styleClass="input-width" maxlength="11"
                         rendered="#{!bean.onlyView}"/>
            <h:outputText value="#{bean.entity.numberVAT}"
                          style="font-weight: bold;" rendered="#{bean.onlyView}"/>

            <span><span class="red">*</span>
                #{msg.databaseListSubjectFiscalCode}:</span>
            <p:inputText maxlength="16" value="#{bean.entity.fiscalCode}" id="codeFiscal" styleClass="input-width"
                         rendered="#{!bean.onlyView}"/>
            <h:outputText value="#{bean.entity.fiscalCode}"
                          style="font-weight: bold;" rendered="#{bean.onlyView}"/>

        </p:panelGrid>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                     columnClasses="ui-grid-col-2, ui-grid-col-3">

            <ui:fragment>
                <span class="red">*</span>
                <h:outputText
                        value="#{bean.isPhysicalPerson ? msg.databaseListSubjectProvince : msg.databaseListSubjectNativeProvince}:"/>
            </ui:fragment>
            <ui:fragment>
                <p:selectOneMenu id="province" value="#{bean.addressProvinceId}" styleClass="select-width"
                                 label="#{msg.databaseListSubjectProvince}:"
                                 rendered="#{!bean.onlyView}">
                    <p:ajax update="province, city, country"
                            listener="#{subjectBean.handleAddressProvinceChange}"/>
                    <f:selectItems value="#{bean.provinces}"/>
                </p:selectOneMenu>
                <h:outputText value="#{bean.provinceDescription}"
                              rendered="#{bean.onlyView}" style="font-weight: bold;"/>
            </ui:fragment>

            <ui:fragment>
                <span class="red">*</span>
                <h:outputText
                        value="#{bean.isPhysicalPerson ? msg.databaseListSubjectCity : msg.databaseListSubjectNativeCity}:"/>
            </ui:fragment>
            <ui:fragment>
                <p:selectOneMenu id="city" value="#{bean.addressCityId}" styleClass="select-width"
                                 style="display: #{bean.foreignCountry ? 'none' : ''};"
                                 label="#{msg.databaseListSubjectCity}:"
                                 rendered="#{!bean.onlyView}">
                    <f:selectItems value="#{bean.addressCities}"/>
                </p:selectOneMenu>
                <h:outputText value="#{bean.cityDescription}"
                              rendered="#{bean.onlyView}"
                              style="font-weight: bold;display: #{bean.foreignCountry ? 'none' : ''};"/>

                <p:selectOneMenu id="country" value="#{bean.selectedCountryId}" styleClass="select-width"
                                 style="display: #{bean.foreignCountry ? '' : 'none'};"
                                 label="#{msg.databaseListSubjectCity}:"
                                 rendered="#{!bean.onlyView}">
                    <f:selectItems value="#{bean.countries}"/>
                </p:selectOneMenu>
                <h:outputText value="#{bean.countryDescription}"
                              rendered="#{bean.onlyView}"
                              style="font-weight: bold;display: #{bean.foreignCountry ? '' : 'none'};"/>
            </ui:fragment>
        </p:panelGrid>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                     columnClasses="ui-grid-col-2, ui-grid-col-3" rendered="#{bean.isPhysicalPerson}">
            <ui:fragment>
                <span class="red">*</span>
                <h:outputText value="#{msg.databaseListSubjectSex}:"/>
            </ui:fragment>
            <p:selectOneRadio value="#{bean.entity.sex}" id="sex"
                              disabled="#{bean.onlyView}">
                <f:selectItems value="#{bean.sexTypes}"/>
            </p:selectOneRadio>


            <h:outputText value="#{msg.databaseListSubjectBornInForeignState}:"/>
            <p:outputPanel>
                <p:selectBooleanCheckbox widgetVar="showAgency"
                                         value="#{bean.entity.bornInForeignState}" onchange="toggleAgency()"
                                         disabled="#{bean.onlyView}"/>

                <p:outputPanel id="agency"
                               style="display: #{bean.entity.bornInForeignState ? '' : 'none'}">
                    <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group">
						<span><span class="red">*</span>
                            #{msg.databaseListSubjectForeignState}:</span>
                        <p:inputText id="foreignState" maxlength="80" styleClass="input-width"
                                     value="#{bean.entity.foreignState}"
                                     label="#{msg.databaseListSubjectForeignState}"
                                     onkeypress="numbers_letters_only('#foreignState');"
                                     rendered="#{!bean.onlyView}"/>
                        <h:outputText value="#{bean.entity.foreignState}"
                                      rendered="#{bean.onlyView}" style="font-weight: bold;"/>
                    </p:panelGrid>
                </p:outputPanel>

            </p:outputPanel>

            <span><span class="red">*</span>
                #{msg.databaseListSubjectFiscalCode}:</span>
            <ui:fragment>
                <div style="width: 100%">
                    <p:inputText id="fiscalCode" maxlength="16"
                                 value="#{bean.entity.fiscalCode}" rendered="#{!bean.onlyView}"/>
                    <h:outputText value="#{bean.entity.fiscalCode}"
                                  rendered="#{bean.onlyView}" style="font-weight: bold;"/>
                    <p:commandButton action="#{bean.generateFiscalCode}"
                                     update="fiscalCode" rendered="#{!bean.onlyView}"
                                     value="#{msg.databaseListSubjectFiscalCodeGenerate}"/>
                </div>
            </ui:fragment>
        </p:panelGrid>

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid"
                     columnClasses="ui-grid-col-2, ui-grid-col-3" rendered="#{not bean.isPhysicalPerson}">
            <h:outputText value="#{msg.databaseListSubjectElectedMortgageHome}:"/>
            <p:inputText value="#{bean.entity.electedMortgageHome}" styleClass="input-width"
                         id="electedMortgageHome" onkeypress="numbers_letters_comma_only('#electedMortgageHome');"
                         maxlength="200" rendered="#{!bean.onlyView}"/>
            <h:outputText value="#{bean.entity.electedMortgageHome}"
                          style="font-weight: bold;" rendered="#{bean.onlyView}"/>

        </p:panelGrid>

        <p:tabView id="tabView" rendered="#{bean.onlyView and not bean.entity.isNew}" binding="#{bean.componentTabView}"/>

        <p:remoteCommand name="updateForm" update=":form"/>

        <p:dialog widgetVar="templates" resizable="false"
                  header="#{msg.docTemplates}" modal="true">
            <p:selectOneMenu value="#{bean.selectedTemplateId}"
                             style="width:150px;">
                <f:selectItems value="#{bean.templates}"/>
            </p:selectOneMenu>

            <div class="btn_line">
                <p:commandButton value="#{msg.ok}" ajax="false"
                                 actionListener="#{bean.generate}" onclick="PF('templates').hide()"
                                 update=":form:messages"/>
                <p:commandButton value="#{msg.cancel}"
                                 onclick="PF('templates').hide()"/>
            </div>
        </p:dialog>
        
        <p:dialog id="documentDialog" widgetVar="documentDialog" modal="true" resizable="false" draggable="false"
                  width="600">
            <p:dataTable value="#{bean.requestDocuments}" var="doc" id="requestDocs" emptyMessage="#{msg.noRecordsFound}">
                <p:column headerText="#{msg.name}">
                    <h:outputText value="#{doc.title}"/>
                </p:column>
                <p:column styleClass="action_column">
                    <p:commandButton icon="fa fa-download" action="#{bean.downloadRequestFile}" ajax="false">
                        <f:setPropertyActionListener value="#{doc.id}" target="#{bean.selectedDocumentId}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </p:dialog>

        <script>
            function toggleAgency() {
                if (PF('showAgency').input[0].checked) {
                    $(document.getElementById('agency')).fadeIn();
                } else {
                    $(document.getElementById('agency')).fadeOut();
                }
            }
        </script>
    </ui:define>

    <ui:define name="additional_buttons">
        <p:commandButton value="#{msg.edit}" rendered="#{bean.onlyView}"
                         update=":form" action="#{bean.editSubject}"
                         con="ui-icon ui-icon-pencil" style="background-color: #00CC52 !important; margin-right: 10px;"/>
        <p:commandButton value="#{msg.save}" rendered="#{not bean.showSave}"
                         update=":form" action="#{bean.saveFromDialog}" styleClass="green-button"
                         icon="ui-icon ui-icon-disk"/>
        <p:commandButton action="#{bean.closeDialog}" styleClass="red-button"
                         rendered="#{not bean.showCancel}" value="#{msg.cancel}"
                         icon="ui-icon-circle-close" style="background-color: #F3362B !important"/>
    </ui:define>

</ui:composition>
