<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <script>
        function filterCity(itemLabel, filterValue) {
            debugger;
            let strArray = itemLabel.split(" ");
            return strArray[1].startsWith(filterValue);
        }
    </script>
    <span>#{enums.documentGenerationTagsSUBJECT_MASTERY}
        <span class="red" style="#{item.field.isRequired() or bean.multipleCreate ? '':'display:none;'}">*</span>
    </span>
    <p:remoteCommand name="updateDate" update="SUBJECT_MASTERY_BIRTHDAY"/>
    <p:panel id="SUBJECT_MASTERY" style="background: transparent; border: none">
        <p:panelGrid columns="2" style="width: 100%;" styleClass="ui-panelgrid-blank form-group" layout="grid">
            <p:column>
<!--                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_PERSON_TYPE}"/><br/>-->
                <p:selectOneRadio id="SUBJECT_MASTERY_PERSON_TYPE" value="#{bean.wrapper.selectedPersonId}"
                                  update="SUBJECT_MASTERY">
                    <f:selectItems value="#{bean.wrapper.persons}"/>
                    <p:ajax update="SUBJECT_MASTERY"/>
                </p:selectOneRadio>
            </p:column>
        </p:panelGrid>
        <p:remoteCommand update="SUBJECT_MASTERY" name="ppp"/>
        <p:panelGrid id="physicalRenderSubjectMastery" columns="4"
                     style="width: 100%;" styleClass="ui-panelgrid-blank form-group" layout="grid">
            <p:column rendered="#{bean.wrapper.selectedPersonId eq 1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SURNAME}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_SURNAME" styleClass="input-width"
                             value="#{bean.subject.surname}" onkeyup="fieldValueToUpperCase(this);"/>
            </p:column>
            <p:column rendered="#{bean.wrapper.selectedPersonId eq 1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_NAME}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_NAME" value="#{bean.subject.name}" styleClass="input-width"
                             onkeyup="fieldValueToUpperCase(this);"/>
            </p:column>
            <p:column rendered="#{bean.wrapper.selectedPersonId eq 1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SEX_TYPE}"/><br/>
                <p:selectOneRadio id="SUBJECT_MASTERY_SEX_TYPE" value="#{bean.wrapper.selectedSexTypeId}">
                    <f:selectItems value="#{bean.wrapper.sexTypes}"/>
                </p:selectOneRadio>
            </p:column>
            <p:column rendered="#{bean.wrapper.selectedPersonId eq 1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_BIRTHDAY}"/><br/>
                <p:calendar id="SUBJECT_MASTERY_BIRTHDAY" value="#{bean.subject.birthDate}"
                            pattern="dd/MM/yyyy" styleClass="calendar-width" mask="true" navigator="true"
                            converter="fullDateTimeConverter" maxdate="today" yearRange="#{bean.yearRange}">
                    <p:ajax event="dateSelect" listener="#{bean.handleDateSelect}" update="SUBJECT_MASTERY_BIRTHDAY"/>
                </p:calendar>
            </p:column>


            <p:column rendered="#{bean.wrapper.selectedPersonId eq 2}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_SOCIAL_REGION}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_SOCIAL_REGION" value="#{bean.subject.businessName}"
                             styleClass="input-width" onkeyup="fieldValueToUpperCase(this);"/>
            </p:column>

            <p:column rendered="#{not empty bean.wrapper.selectedPersonId}">
                <h:outputText value="#{bean.wrapper.selectedPersonId == 1 ? enums.documentGenerationTagsSUBJECT_MASTERY_PROVINCE : enums.documentGenerationTagsSUBJECT_MASTERY_PROVINCE_OFFICE}"/><br/>
                <p:selectOneMenu id="SUBJECT_MASTERY_PROVINCE" value="#{bean.wrapper.selectProvinceId}"
                                 styleClass="select-width" filter="true">
                    <f:selectItems value="#{bean.wrapper.provinces}"/>
                    <p:ajax event="change"
                            oncomplete="ppp();"
                            listener="#{bean.onChangeProvince}"/>
                </p:selectOneMenu>
            </p:column>

            <p:column id="comune_column"
                      rendered="#{not empty bean.wrapper.selectedPersonId and bean.wrapper.selectProvinceId!=-1}">
                <h:outputText value="#{bean.wrapper.selectedPersonId == 1 ? enums.documentGenerationTagsSUBJECT_MASTERY_COMUNE : enums.documentGenerationTagsSUBJECT_MASTERY_COMUNE_OFFICE}"/><br/>
                <p:selectOneMenu id="SUBJECT_MASTERY_COMUNE" value="#{bean.wrapper.selectedCityId}"
                                 styleClass="select-width" filter="true" filterFunction="filterCity"
                                 filterMatchMode="custom">
                    <f:selectItems value="#{bean.wrapper.cities}"/>
                </p:selectOneMenu>
            </p:column>
            <p:column id="juridical_nations_column"
                      rendered="#{bean.wrapper.selectedPersonId==2 and bean.wrapper.selectProvinceId == -1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_JURIDICAL_NATIONS}"/><br/>
                <p:selectOneMenu id="SUBJECT_MASTERY_JURIDICAL_NATIONS" styleClass="select-width"
                                 value="#{bean.wrapper.selectedJuridicalNationId}" filter="true">
                    <f:selectItems value="#{bean.wrapper.juridicalNations}"/>
                </p:selectOneMenu>
            </p:column>

            <p:column rendered="#{bean.wrapper.selectedPersonId eq 2}"/>

            <p:column rendered="#{bean.wrapper.selectedPersonId eq 2}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_IVA}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_IVA" value="#{bean.subject.numberVAT}"
                             styleClass="input-width"/>
                <br/>
                <p:commandButton action="#{bean.restoreFiscalCode}"
                                 update="SUBJECT_MASTERY, messages" style="margin-top: 3px"
                                 value="#{msg.databaseListSubjectIVARestore}"/>
            </p:column>
             <p:column rendered="#{bean.wrapper.selectedPersonId eq 2}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_OLD_IVA}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_OLD_IVA" value="#{bean.subject.oldNumberVAT}"
                             styleClass="input-width"/>
            </p:column>
            <p:column rendered="#{bean.wrapper.selectedPersonId eq 2}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_FISCAL_CODE}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_IVA_FISCAL_CODE" value="#{bean.subject.fiscalCode}"
                             onkeyup="fieldValueToUpperCase(this);" styleClass="input-width"/>
            </p:column>

            <p:column id="nations_column"
                      rendered="#{bean.wrapper.selectedPersonId==1 and bean.wrapper.selectProvinceId==-1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_NATIONS}"/><br/>
                <p:selectOneMenu id="SUBJECT_MASTERY_NATIONS" value="#{bean.wrapper.selectedNationId}"
                                 styleClass="select-width" filter="true">
                    <f:selectItems value="#{bean.wrapper.nations}"/>
                </p:selectOneMenu>
            </p:column>
            <p:column id="fiscal_code_column" rendered="#{bean.wrapper.selectedPersonId eq 1}">
                <h:outputText value="#{enums.documentGenerationTagsSUBJECT_MASTERY_FISCAL_CODE}"/><br/>
                <p:inputText id="SUBJECT_MASTERY_FISCAL_CODE" value="#{bean.subject.fiscalCode}"
                             onkeyup="fieldValueToUpperCase(this);" styleClass="input-width"/>
                <br/>
                <p:commandButton action="#{bean.generateFiscalCode}"
                                 update="SUBJECT_MASTERY_FISCAL_CODE" style="margin-top: 3px"
                                 value="#{msg.databaseListSubjectFiscalCodeGenerate}"/>
                <p:commandButton action="#{bean.restoreFiscalCode}"
                                 update="SUBJECT_MASTERY, messages" style="margin-top: 3px"
                                 value="#{msg.databaseListSubjectFiscalCodeRestore}"/>
            </p:column>
        </p:panelGrid>
        <p:dialog id="subjectRestoreDlg" widgetVar="subjectRestoreDlg" modal="true" draggable="false" position="center center" width="1500">
            <p:dataTable value="#{bean.subjectsToRestore}" var="subject" selection="#{bean.selectedSubjectToRestore}"
                         rowKey="#{subject.id}" id="restoreSubjectTable">
                <p:column selectionMode="single" style="width:35px;text-align:center"/>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SOCIAL_REGION}"
                          rendered="#{bean.wrapper.selectedPersonId eq 2}">
                    <h:outputText value="#{subject.businessName}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_IVA}"
                          rendered="#{bean.wrapper.selectedPersonId eq 2}">
                    <h:outputText value="#{subject.numberVAT}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SURNAME}"
                          rendered="#{bean.wrapper.selectedPersonId eq 1}">
                    <h:outputText value="#{subject.surname}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_NAME}"
                          rendered="#{bean.wrapper.selectedPersonId eq 1}">
                    <h:outputText value="#{subject.name}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_SEX_TYPE}"
                          rendered="#{bean.wrapper.selectedPersonId eq 1}">
                    <h:outputText value="#{subject.sexType ne null ? subject.sexType.toString() : ''}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_BIRTHDAY}"
                          rendered="#{bean.wrapper.selectedPersonId eq 1}">
                    <h:outputText value="#{subject.birthDate}" converter="dateTimeConverter"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_FISCAL_CODE}">
                    <h:outputText value="#{subject.fiscalCode}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_PROVINCE}">
                    <h:outputText value="#{subject.birthProvince}"/>
                </p:column>
                <p:column headerText="#{enums.documentGenerationTagsSUBJECT_MASTERY_COMUNE}">
                    <h:outputText value="#{subject.birthCity}"/>
                </p:column>

            </p:dataTable>
            <div class="btn_line">
                <p:commandButton value="#{msg.confirm}" update="SUBJECT_MASTERY" process="restoreSubjectTable"  styleClass="confirm-button"
                                 oncomplete="PF('subjectRestoreDlg').hide();"
                                 action="#{bean.selectRestoredSubject}"/>

            </div>
        </p:dialog>
    </p:panel>
</ui:composition>