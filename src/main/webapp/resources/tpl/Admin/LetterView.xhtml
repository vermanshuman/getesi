<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <link href="#{facesContext.externalContext.requestContextPath}/resources/chart/css/demo.css"
          media="all" rel="stylesheet" type="text/css"/>
    <p:panel id="button_panel" toggleable="true"
             style="overflow-y: auto; overflow-x: hidden; word-wrap: break-word; white-space: normal; border: 0;z-index: 1000">
        <ui:include src="/resources/tpl/Admin/Include/LetterLine.xhtml"/>
    </p:panel>

    <p:panel id="letter_panel" toggleable="true"
             style="overflow-y: auto; overflow-x: hidden; word-wrap: break-word; white-space: normal; margin-top: 0; position: relative; top: 68px; border: 0; margin-bottom: 68px;">

        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" id="referenceAreaShow">

            <h:outputText value="#{msg.clientType}:"/>
            <p:selectOneMenu id="clientType" value="#{bean.clientTypeId}"
                             styleClass="select-width" label="#{msg.clientType}">
                <f:selectItems value="#{bean.clientTypes}" />
                <p:ajax event="change" listener="#{bean.initOfficesList}" update="client_not_manger_or_fiduciary_id client_fiduciary_id mail_ofice_id managers client_invoice_id"/>
            </p:selectOneMenu>
            <h:outputText value="#{msg.client}:"/>
            <p:selectOneMenu id="client_not_manger_or_fiduciary_id"
                             value="#{bean.selectedNotManagerOrFiduciaryClientId}"
                             styleClass="input-width-mmv">
                <f:selectItems value="#{bean.notManagerOrFiduciaryClients}"/>
                <p:ajax event="change" listener="#{bean.initOfficesList}" update="client_fiduciary_id mail_ofice_id managers client_invoice_id"/>
            </p:selectOneMenu>

            <h:outputText value="#{msg.mailBilling}:"/>
            <p:selectOneMenu id="client_invoice_id" value="#{bean.selectedClientInvoiceId}" styleClass="input-width-mmv">
                <f:selectItems value="#{bean.invoiceClients}"/>
            </p:selectOneMenu>

            <h:outputText value="#{msg.mailTrust}:"/>
            <p:selectOneMenu id="client_fiduciary_id" value="#{bean.selectedClientFiduciaryId}" styleClass="input-width-mmv">
                <f:selectItems value="#{bean.fiduciaryClientsList}"/>
            </p:selectOneMenu>

            <span>#{msg.clientManager}</span>
            <p:selectCheckboxMenu id="managers" value="#{bean.selectedClientManagers}" style="width: 100%"
                                  label="#{enums.documentGenerationTagsMANAGER}"
                                  converter="#{bean.clientSelectItemWrapperConverter}"
                                  multiple="true" filter="true" filterMatchMode="startsWith" >
                <f:selectItems value="#{bean.clientManagers}" var="con" itemValue="#{con}"
                               itemLabel="#{con.label}"/>
                <p:ajax process="managers"/>
            </p:selectCheckboxMenu>

            <h:outputText value="#{msg.mailManagerViewOffice}:"/>
            <p:selectOneMenu id="mail_ofice_id" value="#{bean.selectedOfficeId}" styleClass="input-width-mmv">
                <f:selectItems value="#{bean.officeList}"/>
            </p:selectOneMenu>
            <span> #{msg.ndgText}</span>
            <p:inputText id="ndgShow" value="#{bean.ndg}"  style="width: 100%"/>
            <span> #{msg.cdrText}</span>
            <p:inputText id="cdrShow" value="#{bean.cdr}"  style="width: 100%"/>
            <span> #{msg.reference}</span>
            <p:inputTextarea id="referenceShow" value="#{bean.referencePractice}" style="width: 100%"/>
            <p:outputPanel>
                <p:commandButton value="#{msg.save}" process="referenceAreaShow" style="background-color: #57c279!important; margin-right:5px;"
                                 action="#{bean.saveReference(false)}" update="enterPracticeReferenceDialog @form" oncomplete="setTimeout(function() { $('#validationMessages').html(''); }, 2000);">
                    <f:setPropertyActionListener value="#{true}" target="#{bean.confirmButtonIsClicked}"/>
                </p:commandButton>
                <!-- <p:commandButton value="#{msg.mailManagerStart}" process="referenceAreaShow"
                                 action="#{bean.checkFieldsBeforeProcessManagedStateCheck}" update="fieldsNotSetDialog">
                    <f:setPropertyActionListener value="#{true}" target="#{bean.confirmButtonIsClicked}"/>
                </p:commandButton> -->
            </p:outputPanel>
        </p:panelGrid>
        <br/><br/>
        <div class="p-grid table-demo">
            <div class="p-col-12">
                <div class="card">
                    <p:dataTable widgetVar="validRequestsDT" var="item" value="#{bean.entity.validRequests}" reflow="true">
                        <f:facet name="header">
                            <div class="customers-table-header">
                                <span style="font-weight: bold"></span>

                                <span class="ui-input-icon-left filter-container">
                                                    <i class="pi pi-search"/>
                                                    <p:inputText id="globalFilter" onkeyup="PF('validRequestsDT').filter()" placeholder="Global Search"/>
                                                </span>
                            </div>
                        </f:facet>
                        <p:column styleClass=" action_column">
                            <p:commandButton icon="ui-icon pi pi-pencil" update=":form" action="#{bean.gotoEditRequest}">
                                <f:setPropertyActionListener value="#{item.id}" target="#{bean.entityEditId}"/>
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="#{msg.databaseListRealEstateSubject}" sortBy="#{item.mailViewSubject}" filterBy="#{item.mailViewSubject}">
                            <h:outputText value="#{item.mailViewSubject}"/>
                        </p:column>
                        <p:column headerText="#{msg.requestListRequestType}" sortBy="#{item.mailViewSubject}" filterBy="#{item.mailViewSubject}">
                            <h:outputText value="#{item.requestTypeName}"/>
                        </p:column>
                        <p:column headerText="#{msg.requestListService}" sortBy="#{item.mailViewSubject}" filterBy="#{item.mailViewSubject}">
                            <h:outputText value="#{item.service ne null ? item.serviceName : (item.multipleServices ne null ? item.multipleServiceNames : '')}"/>
                        </p:column>
                        <p:column headerText="#{msg.requestListCorservatoryName}" sortBy="#{item.mailViewSubject}" filterBy="#{item.mailViewSubject}">
                            <h:outputText value="#{item.aggregationLandCharRegNameOrCity}"/>
                        </p:column>
                        <p:column headerText="#{msg.requestState}" sortBy="#{item.mailViewSubject}" filterBy="#{item.mailViewSubject}">
                            <h:outputText value="#{item.stateDescription}"/>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>
        <br/><br/>
        <div style="overflow: hidden; width: 0px; height: 0px; margin: 0; padding: 0; display: none">
            <p:fileUpload id="mail_file_upload" fileUploadListener="#{bean.handleFileUpload}"
                          mode="advanced" auto="true" update="letter_panel"/>
        </div>

        <p:outputPanel id="onlyBody" style="color:black !important">
            <div class="ui-g">
                <div class="ui-g-3"
                     style="border-radius: 50%; background-color: #2f8ee5; width: 50px; height: 50px; text-align: center">
                    <h:outputText converter="mailLetterConverter" value="#{bean.entity.emailFrom}"
                                  styleClass="one_mail_letter"/>
                </div>
                <div class="ui-g-9">
                    <div>
                        <h:outputText value="#{bean.entity.emailFrom}"
                                      styleClass="worklist-expansion-value" style="font-size: 12.5pt;"/>
                    </div>
                    <div>
                        <h:outputText value="#{bean.entity.sendDate}" converter="dateTimeConverterWithMinutes"
                                      rendered="#{!bean.entity.received}" style="font-size: 10pt;"/>
                        <h:outputText value="#{bean.entity.sendDate}" converter="dateTimeConverterWithMinutesLocal"
                                      rendered="#{bean.entity.received}" style="font-size: 10pt;"/>
                    </div>
                    <div>
                        <h:outputText value="#{bean.entity.emailBCC}"
                                      styleClass="worklist-expansion-value"
                                      style="font-size: 9pt; color: black; font-weight: bold"/>
                    </div>
                    <div>
                        <h:outputText value="#{bean.entity.priorityWrapper.message}"
                                      rendered="#{not empty bean.entity.priorityWrapper.message}"
                                      style="font-size: 10pt;"/>
                    </div>
                </div>
            </div>
            <div class="ui-g">
                <div class="ui-g-2">
                    <h:outputText value="#{msg.mailManagerEmailTo}:"
                                  rendered="#{not empty bean.entity.emailTo}"/>
                </div>
                <div class="ui-g-10">
                    <h:outputText value="#{bean.entity.emailTo}"
                                  rendered="#{not empty bean.entity.emailTo}"/>
                </div>
            </div>
            <div class="ui-g" style="#{empty bean.entity.emailCC ? 'display: none' : ''}">
                <div class="ui-g-2">
                    <h:outputText value="#{msg.mailManagerEditMailCopy}:"
                                  rendered="#{not empty bean.entity.emailCC}"/>
                </div>
                <div class="ui-g-10">
                    <h:outputText value="#{bean.entity.emailCC}"
                                  rendered="#{not empty bean.entity.emailCC}"/>
                </div>
            </div>
            <div class="ui-g" style="#{empty bean.entity.emailSubject ? 'display: none' : ''}">
                <div class="ui-g-2">
                    <h:outputText value="#{msg.mailManagerEditMailSubject}:"
                                  rendered="#{not empty bean.entity.emailSubject}"/>
                </div>
                <div class="ui-g-10">
                    <h:outputText value="#{bean.entity.emailSubject}"
                                  rendered="#{not empty bean.entity.emailSubject}"/>
                </div>
            </div>
            <div class="ui-g">
                <div class="ui-g-2">
                    <h:outputText value="#{msg.mailManagerAttachedFiles}:"
                                  rendered="#{not empty bean.attachedFiles}"/>
                </div>
                <div class="ui-g-10">
                    <ui:repeat value="#{bean.attachedFiles}" var="file">
                        <i class="#{file.icon} #{file.style}"/>
                        <p:commandLink title="#{msg.download}" update=":form, messages" ajax="false"
                                       action="#{bean.downloadFile}" value="&nbsp;#{file.fileName}"
                                       style="color: black; padding-right: 5px;">
                            <f:setPropertyActionListener value="#{file.id}" target="#{bean.downloadFileIndex}"/>
                        </p:commandLink>
                    </ui:repeat>
                </div>
            </div>
            <p:separator/>
            <div class="ui-g">
                <div class="ui-g-12">
                    <h:outputText value="#{bean.emailBody}" escape="false" styleClass="email-body-black"/>
                </div>
            </div>
        </p:outputPanel>
    </p:panel>
    <p:dialog id="fieldsNotSetDialog" widgetVar="fieldsNotSetDialogWV" modal="true" width="500"
              draggable="false" resizable="false">
        <h:outputText value="#{bean.fieldsNotSetDialogMessage}"/>
        <br/>
        <h:outputText value="#{msg.mailManagerViewFieldsNotSetDialogMessageQuestion}"/>
        <br/>
        <div class="btn_line">
            <p:commandButton value="#{msg.confirm}"
                             action="#{bean.processManagedStateCheck}" oncomplete="PF('fieldsNotSetDialogWV').hide();"/>
            <p:commandButton value="#{msg.cancel}" oncomplete="PF('fieldsNotSetDialogWV').hide();"/>
        </div>
    </p:dialog>
    <p:dialog id="showToBeSentRequest" widgetVar="showToBeSentRequestDlgWV" styleClass="table-center"
              resizable="false" closable="false" draggable="true" modal="true"
              header="#{msg.selectToBeSentRequest}">
        <p:outputPanel widgetVar="showToBeSentRequestPanel" id="showToBeSentRequestPanel">
            <p:dataTable value="#{bean.entity.toBeSentRequests}" styleClass="simple-table" var="item"
                         rendered="#{not empty bean.entity.validRequests}">
                <p:column width="7%" styleClass="small-btn-column">
                    <p:selectBooleanCheckbox value="#{item.selected}"/>
                </p:column>
                <p:column headerText="#{msg.databaseListRealEstateSubject}">
                    <h:outputText value="#{item.mailViewSubject}"/>
                </p:column>
                <p:column headerText="#{msg.requestListRequestType}">
                    <h:outputText value="#{item.requestTypeName}"/>
                </p:column>
                <p:column headerText="#{msg.requestListService}">
                    <h:outputText value="#{item.service ne null ? item.serviceName : (item.multipleServices ne null ? item.multipleServiceNames : '')}"/>
                </p:column>
                <p:column headerText="#{msg.requestListCorservatoryName}">
                    <h:outputText value="#{item.aggregationLandCharRegNameOrCity}"/>
                </p:column>
            </p:dataTable>
            <div class="btn_line">
                <p:commandButton value="#{msg.confirm}"
                                 action="#{bean.openMailManagerEditor}"
                                 update="form"
                                 oncomplete="PF('showToBeSentRequestDlgWV').hide();"/>
                <p:commandButton value="#{msg.cancel}"
                                 oncomplete="PF('showToBeSentRequestDlgWV').hide();"/>
            </div>
        </p:outputPanel>
    </p:dialog>
    <ui:include src="/resources/tpl/Admin/Include/MailManagerDialog.xhtml"/>
</ui:composition>
